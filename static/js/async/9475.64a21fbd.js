"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([["9475"],{39182:function(e,n,s){s.r(n),s.d(n,{default:()=>h});var t=s(52676),a=s(40453),r=s(20713);let i=s.p+"static/image/stepper.32781cc1.png",d=s.p+"static/image/debugger.57eaf8ec.png",l=s.p+"static/image/debugger-wx.53da1ee8.png";function c(e){let n=Object.assign({h1:"h1",a:"a",h2:"h2",blockquote:"blockquote",p:"p",strong:"strong",code:"code",img:"img",pre:"pre",h3:"h3",h4:"h4",hr:"hr"},(0,a.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.h1,{id:"经常用-vant-weapp-开发小程序却不知道如何开发一个组件",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#经常用-vant-weapp-开发小程序却不知道如何开发一个组件",children:"#"}),"经常用 vant-weapp 开发小程序，却不知道如何开发一个组件？"]}),"\n",(0,t.jsx)(r.Z,{defaultLocale:"zh-CN"}),"\n",(0,t.jsxs)(n.h2,{id:"1-前言",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1-前言",children:"#"}),"1. 前言"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["大家好，我是",(0,t.jsx)(n.a,{href:"https://ruochuan12.github.io",rel:"noopener noreferrer",target:"_blank",children:"若川"}),"。",(0,t.jsx)(n.strong,{children:"为了能帮助到更多对源码感兴趣、想学会看源码、提升自己前端技术能力的同学"}),"。我倾力持续组织了一年",(0,t.jsx)(n.a,{href:"https://juejin.cn/post/7079706017579139102",rel:"noopener noreferrer",target:"_blank",children:"每周大家一起学习200行左右的源码共读活动"}),"，感兴趣的可以 ",(0,t.jsxs)(n.a,{href:"https://juejin.cn/pin/7217386885793595453",rel:"noopener noreferrer",target:"_blank",children:["点此扫码加我微信 ",(0,t.jsx)(n.code,{children:"ruochuan02"})," 参与"]}),"。"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["想学源码，极力推荐关注我写的专栏（目前是掘金专栏关注人数第一，3.6K+人）",(0,t.jsx)(n.a,{href:"https://juejin.cn/column/6960551178908205093",rel:"noopener noreferrer",target:"_blank",children:"《学习源码整体架构系列》"})," 包含",(0,t.jsx)(n.code,{children:"jQuery"}),"、",(0,t.jsx)(n.code,{children:"underscore"}),"、",(0,t.jsx)(n.code,{children:"lodash"}),"、",(0,t.jsx)(n.code,{children:"vuex"}),"、",(0,t.jsx)(n.code,{children:"sentry"}),"、",(0,t.jsx)(n.code,{children:"axios"}),"、",(0,t.jsx)(n.code,{children:"redux"}),"、",(0,t.jsx)(n.code,{children:"koa"}),"、",(0,t.jsx)(n.code,{children:"vue-devtools"}),"、",(0,t.jsx)(n.code,{children:"vuex4"}),"、",(0,t.jsx)(n.code,{children:"koa-compose"}),"、",(0,t.jsx)(n.code,{children:"vue 3.2 发布"}),"、",(0,t.jsx)(n.code,{children:"vue-this"}),"、",(0,t.jsx)(n.code,{children:"create-vue"}),"、",(0,t.jsx)(n.code,{children:"玩具vite"}),"等20余篇源码文章。"]}),"\n",(0,t.jsxs)(n.h2,{id:"2-stepper-步进器",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2-stepper-步进器",children:"#"}),"2. stepper 步进器"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["感兴趣的小伙伴，可以克隆我的仓库调试学习 ",(0,t.jsx)(n.a,{href:"https://github.com/ruochuan12/vant-weapp-analysis.git",rel:"noopener noreferrer",target:"_blank",children:"git clone https://github.com/ruochuan12/vant-weapp-analysis.git"}),"。"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["我们开发微信小程序时经常会使用到 ",(0,t.jsx)(n.code,{children:"stepper"})," 步进器组件。本文就来分析 ",(0,t.jsx)(n.code,{children:"vant-weapp"})," ",(0,t.jsx)(n.code,{children:"stepper"})," 步进器源码实现。"]}),"\n",(0,t.jsxs)(n.p,{children:["相比于原生 ",(0,t.jsx)(n.code,{children:"JS"})," 等源码。我们或许更应该学习，正在使用的组件库的源码，因为有助于帮助我们写业务和写自己的组件。"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://vant-contrib.gitee.io/vant-weapp/#/stepper",rel:"noopener noreferrer",target:"_blank",children:"stepper 步进器文档"})}),"\n",(0,t.jsx)(n.p,{children:"stepper 图"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"stepper 图",src:i})}),"\n",(0,t.jsxs)(n.p,{children:["如何开发一个微信小程序组件，可以参考官方文档。\n",(0,t.jsx)(n.a,{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/",rel:"noopener noreferrer",target:"_blank",children:"微信小程序自定义组件 文档"})]}),"\n",(0,t.jsx)(n.p,{children:"看完本文，你将学到："}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"1. 学会如何通过调试看源码\n2. 如何写一个微信小程序的组件\n3. 学会开发一个 stepper 步进器组件\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"3-克隆项目--调试",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#3-克隆项目--调试",children:"#"}),"3. 克隆项目 && 调试"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/vant-ui/vant-weapp.git\n\n# 也可以克隆我的仓库\ngit clone https://github.com/ruochuan12/vant-weapp-analysis.git\ncd vant-weapp-analysis/vant-weapp\n\nyarn install\nyarn run dev\n"})}),"\n",(0,t.jsxs)(n.p,{children:["由于 ",(0,t.jsx)(n.code,{children:"yarn run dev"})," 没有压缩代码，本文就基于运行 ",(0,t.jsx)(n.code,{children:"dev"})," 后没有压缩的代码进行讲述。"]}),"\n",(0,t.jsxs)(n.p,{children:["打开",(0,t.jsx)(n.a,{href:"https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html",rel:"noopener noreferrer",target:"_blank",children:"微信开发者工具"}),"，把 ",(0,t.jsx)(n.code,{children:"vant-weapp/example"})," 目录添加进去就可以预览示例了。注意：如果没有自己的 ",(0,t.jsx)(n.code,{children:"appid"}),"，可以选择测试号。"]}),"\n",(0,t.jsxs)(n.p,{children:["添加编译模式，启动页面为 ",(0,t.jsx)(n.code,{children:"pages/stepper/index"}),"，即可单独调试该页面。"]}),"\n",(0,t.jsxs)(n.p,{children:["关于更多 ",(0,t.jsx)(n.code,{children:"JS"})," 调试，之前文章写过，",(0,t.jsx)(n.a,{href:"https://juejin.cn/post/7030584939020042254",rel:"noopener noreferrer",target:"_blank",children:"新手向：前端程序员必学基本技能——调试JS代码"}),"，这里就不赘述。"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://mp.weixin.qq.com/s/VOoDHqIo4gh3scHVNxk3lA",rel:"noopener noreferrer",target:"_blank",children:"前端容易忽略的 debugger 调试技巧"})}),"\n",(0,t.jsx)(n.p,{children:"附上一张图。"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"debugger",src:d})}),"\n",(0,t.jsx)(n.p,{children:"我们找到对应的文件，查看下组件源码的整体结构。"}),"\n",(0,t.jsxs)(n.h2,{id:"4-整体结构",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#4-整体结构",children:"#"}),"4. 整体结构"]}),"\n",(0,t.jsxs)(n.h3,{id:"41-组件的-wxml-结构",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#41-组件的-wxml-结构",children:"#"}),"4.1 组件的 wxml 结构"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"wxml"})," 部分相对简单清晰，这里就不过多讲述。"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:'\x3c!-- vant-weapp/example/dist/stepper/index.wxml --\x3e\n<wxs src="../wxs/utils.wxs" module="utils" />\n<wxs src="./index.wxs" module="computed" />\n\n<view class="{{ utils.bem(\'stepper\', [theme]) }} custom-class">\n  <view\n    wx:if="{{ showMinus }}"\n    data-type="minus"\n    style="{{ computed.buttonStyle({ buttonSize }) }}"\n    class="minus-class {{ utils.bem(\'stepper__minus\', { disabled: disabled || disableMinus || currentValue <= min }) }}"\n    hover-class="van-stepper__minus--hover"\n    hover-stay-time="70"\n    bind:tap="onTap"\n    bind:touchstart="onTouchStart"\n    bind:touchend="onTouchEnd"\n  >\n    <slot name="minus" />\n  </view>\n  <input\n    always-embed="{{ false }}"\n    type="{{ integer ? \'number\' : \'digit\' }}"\n    class="input-class {{ utils.bem(\'stepper__input\', { disabled: disabled || disableInput }) }}"\n    style="{{ computed.inputStyle({ buttonSize, inputWidth }) }}"\n    value="{{ currentValue }}"\n    focus="{{ focus }}"\n    disabled="{{ disabled || disableInput }}"\n    always-embed="{{ alwaysEmbed }}"\n    bindinput="onInput"\n    bind:focus="onFocus"\n    bind:blur="onBlur"\n  />\n  <view\n    wx:if="{{ showPlus }}"\n    data-type="plus"\n    style="{{ computed.buttonStyle({ buttonSize }) }}"\n    class="plus-class {{ utils.bem(\'stepper__plus\', { disabled: disabled || disablePlus || currentValue >= max }) }}"\n    hover-class="van-stepper__plus--hover"\n    hover-stay-time="70"\n    bind:tap="onTap"\n    bind:touchstart="onTouchStart"\n    bind:touchend="onTouchEnd"\n  >\n    <slot name="plus" />\n  </view>\n</view>\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"42-组件的-js-结构",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#42-组件的-js-结构",children:"#"}),"4.2 组件的 JS 结构"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// vant-weapp/example/dist/stepper/index.js\nimport { VantComponent } from '../common/component';\n// 不等于 undefined 也不等于 null\n// export function isDef(value) {\n//    return value !== undefined && value !== null;\n// }\nimport { isDef } from '../common/validator';\n// 长按开始时间\nconst LONG_PRESS_START_TIME = 600;\n// 长按定时器\nconst LONG_PRESS_INTERVAL = 200;\n// add num and avoid float number\n// 为了解决类似 0.1 + 0.2 !== 0.3 的问题\n// 0.1 + 0.2 === 0.30000000000000004\nfunction add(num1, num2) {\n    const cardinal = Math.pow(10, 10);\n    return Math.round((num1 + num2) * cardinal) / cardinal;\n}\n// 判断两个字符串相等\nfunction equal(value1, value2) {\n    return String(value1) === String(value2);\n}\ndebugger;\nVantComponent({\n    field: true,\n    classes: ['input-class', 'plus-class', 'minus-class'],\n    // 代码省略 props、created、methods 函数中若干内容\n    props: {\n        value: {\n            type: null,\n            observer: 'observeValue',\n        },\n    },\n    data: {\n        currentValue: '',\n    },\n    created() {\n        this.setData({\n            currentValue: this.format(this.data.value),\n        });\n    },\n    methods: {\n    },\n});\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"43-vantcomponent-组件",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#43-vantcomponent-组件",children:"#"}),"4.3 VantComponent 组件"]}),"\n",(0,t.jsxs)(n.p,{children:["我们可以在 ",(0,t.jsx)(n.code,{children:"vant-weapp/example/dist/stepper/index.js"})," 文件的 ",(0,t.jsx)(n.code,{children:"VantComponent({})"})," 上方加上 ",(0,t.jsx)(n.code,{children:"debugger;"})," 调试源码。按进入函数按钮。"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// vant-weapp/example/dist/stepper/index.js\ndebugger;\nVantComponent({})\n"})}),"\n",(0,t.jsx)(n.p,{children:"调试如图所示："}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"微信开发者工具调试",src:l})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// vant-weapp/example/dist/common/component.js\nimport { basic } from '../mixins/basic';\nfunction mapKeys(source, target, map) {\n    Object.keys(map).forEach((key) => {\n        if (source[key]) {\n            target[map[key]] = source[key];\n        }\n    });\n}\nfunction VantComponent(vantOptions) {\n    const options = {};\n    // Vue的写法转换成小程序写法\n    mapKeys(vantOptions, options, {\n        data: 'data',\n        props: 'properties',\n        mixins: 'behaviors',\n        methods: 'methods',\n        beforeCreate: 'created',\n        created: 'attached',\n        mounted: 'ready',\n        destroyed: 'detached',\n        classes: 'externalClasses',\n    });\n    // add default externalClasses\n    // 外部样式类，也就是为什么我们可以定义 custom-class 修改样式\n    options.externalClasses = options.externalClasses || [];\n    options.externalClasses.push('custom-class');\n    // add default behaviors\n    // behaviors 是用于组件间代码共享的特性，类似于一些编程语言中的 “mixins” 或 “traits”。\n    // 每个 behavior 可以包含一组属性、数据、生命周期函数和方法。\n    // 组件引用它时，它的属性、数据和方法会被合并到组件中，生命周期函数也会在对应时机被调用。\n    options.behaviors = options.behaviors || [];\n    options.behaviors.push(basic);\n    // add relations\n    // 添加关系 类似 ul li 组件 List => ListItem 组件\n    const { relation } = vantOptions;\n    if (relation) {\n        options.relations = relation.relations;\n        options.behaviors.push(relation.mixin);\n    }\n    // 添加内置的 behavior 参考链接\n    // https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/behaviors.html#wx-form-field\n    // https://developers.weixin.qq.com/miniprogram/dev/component/form.html\n    // map field to form-field behavior\n    if (vantOptions.field) {\n        options.behaviors.push('wx://form-field');\n    }\n    // add default options\n    // 参考：https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html\n    options.options = {\n        // 在组件定义时的选项中启用多 slot 支持\n        multipleSlots: true,\n        addGlobalClass: true,\n    };\n    Component(options);\n}\nexport { VantComponent };\n"})}),"\n",(0,t.jsxs)(n.h4,{id:"431-behavior-如同-mixins",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#431-behavior-如同-mixins",children:"#"}),"4.3.1 Behavior 如同 mixins"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// vant-weapp/example/dist/mixins/basic.js\nexport const basic = Behavior({\n    methods: {\n        $emit(name, detail, options) {\n            this.triggerEvent(name, detail, options);\n        },\n        set(data) {\n            this.setData(data);\n            return new Promise((resolve) => wx.nextTick(resolve));\n        },\n    },\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["看完了 ",(0,t.jsx)(n.code,{children:"VantComponent"})," 函数。\n再来看看组件的初始化。"]}),"\n",(0,t.jsxs)(n.h2,{id:"5-组件初始化",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#5-组件初始化",children:"#"}),"5. 组件初始化"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"VantComponent({\n    field: true,\n    classes: ['input-class', 'plus-class', 'minus-class'],\n    // 代码省略 props、data、created、methods 函数中内容\n    props: {\n        value: {\n            type: null,\n            observer: 'observeValue',\n        },\n        integer: {\n            type: Boolean,\n            observer: 'check',\n        },\n        decimalLength: {\n            type: Number,\n            value: null,\n            observer: 'check',\n        },\n    },\n    data: {\n        currentValue: '',\n    },\n    created() {\n        this.setData({\n            currentValue: this.format(this.data.value),\n        });\n    },\n    methods: {\n        // 观测 value，如果 value、currentValue 两者不相等，以格式化后的 value 值赋值给 currentValue\n        observeValue() {\n            const { value, currentValue } = this.data;\n            if (!equal(value, currentValue)) {\n                this.setData({ currentValue: this.format(value) });\n            }\n        },\n        // 观测格式化后的 currentValue，如果两者不相等，以 value 值赋值给 currentValue\n        check() {\n            const val = this.format(this.data.currentValue);\n            if (!equal(val, this.data.currentValue)) {\n                this.setData({ currentValue: val });\n            }\n        },\n        // filter illegal characters\n        // 格式化 value\n        filter(value) {\n            value = String(value).replace(/[^0-9.-]/g, '');\n            if (this.data.integer && value.indexOf('.') !== -1) {\n                value = value.split('.')[0];\n            }\n            return value;\n        },\n        // 限制 value 的范围\n        // limit value range\n        format(value) {\n            value = this.filter(value);\n            // 处理范围 最大值和最小值\n            // format range\n            value = value === '' ? 0 : +value;\n            value = Math.max(Math.min(this.data.max, value), this.data.min);\n            // 格式化小数位数\n            // format decimal\n            if (isDef(this.data.decimalLength)) {\n                value = value.toFixed(this.data.decimalLength);\n            }\n            return value;\n        },\n    },\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:"接着我们继续调试加减号基础功能。"}),"\n",(0,t.jsxs)(n.h2,{id:"6-点击加号减号",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#6-点击加号减号",children:"#"}),"6. 点击加号/减号"]}),"\n",(0,t.jsxs)(n.h3,{id:"61-ontap-函数",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#61-ontap-函数",children:"#"}),"6.1 onTap 函数"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:'<view\n    bind:tap="onTap"\n></view>\n'})}),"\n",(0,t.jsxs)(n.p,{children:["我们可以在 ",(0,t.jsx)(n.code,{children:"onTap"})," 函数处断点，或者加上 ",(0,t.jsx)(n.code,{children:"debugger"}),"。"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'onTap(event) {\n    debugger;\n    // data-type="minus"\n    const { type } = event.currentTarget.dataset;\n    this.type = type;\n    this.onChange();\n},\n'})}),"\n",(0,t.jsxs)(n.p,{children:["再在 ",(0,t.jsx)(n.code,{children:"onChange"})," 函数断点，点击进入函数按钮操作。\n接着我们来看 ",(0,t.jsx)(n.code,{children:"onChange"})," 函数实现。"]}),"\n",(0,t.jsxs)(n.h3,{id:"62-onchange-函数",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#62-onchange-函数",children:"#"}),"6.2 onChange 函数"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"onChange() {\n    const { type } = this;\n    // 超出了，派发超过 overlimit 事件\n    if (this.isDisabled(type)) {\n        this.$emit('overlimit', type);\n        return;\n    }\n    // 差值 step 步长\n    const diff = type === 'minus' ? -this.data.step : +this.data.step;\n    // 格式化\n    const value = this.format(add(+this.data.currentValue, diff));\n    this.emitChange(value);\n    this.$emit(type);\n},\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"63-isdisabled-函数",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#63-isdisabled-函数",children:"#"}),"6.3 isDisabled 函数"]}),"\n",(0,t.jsx)(n.p,{children:"最大最小值比较等。"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"isDisabled(type) {\n    const { disabled, disablePlus, disableMinus, currentValue, max, min, } = this.data;\n    if (type === 'plus') {\n        return disabled || disablePlus || currentValue >= max;\n    }\n    return disabled || disableMinus || currentValue <= min;\n},\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"64-emitchange-函数",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#64-emitchange-函数",children:"#"}),"6.4 emitChange 函数"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"emitChange(value) {\n    if (!this.data.asyncChange) {\n        this.setData({ currentValue: value });\n    }\n    this.$emit('change', value);\n},\n"})}),"\n",(0,t.jsxs)(n.p,{children:["如果不是异步，则直接赋值给 ",(0,t.jsx)(n.code,{children:"currentValue"}),"。\n并且派发 ",(0,t.jsx)(n.code,{children:"change"})," 事件。"]}),"\n",(0,t.jsxs)(n.p,{children:["断点调试在 ",(0,t.jsx)(n.code,{children:"$emit"})," 函数。点击开发者工具的进入函数按钮。"]}),"\n",(0,t.jsxs)(n.h3,{id:"65-emit-函数",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#65-emit-函数",children:"#"}),"6.5 $emit 函数"]}),"\n",(0,t.jsxs)(n.p,{children:["在上文提到过 ",(0,t.jsx)(n.code,{children:"Behavior"})," ",(0,t.jsx)(n.code,{children:"basic"}),"。类似于 ",(0,t.jsx)(n.code,{children:"vue"})," 中的 ",(0,t.jsx)(n.code,{children:"$emit"}),"。"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"$emit(name, detail, options) {\n    this.triggerEvent(name, detail, options);\n},\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/events.html",rel:"noopener noreferrer",target:"_blank",children:"组件间通信与事件 文档"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'\x3c!-- 当自定义组件触发“myevent”事件时，调用“onMyEvent”方法 --\x3e\n<component-tag-name bindmyevent="onMyEvent" />\n\x3c!-- 或者可以写成 --\x3e\n<component-tag-name bind:myevent="onMyEvent" />\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'\x3c!-- 在自定义组件中 --\x3e\n<button bindtap="onTap">点击这个按钮将触发“myevent”事件</button>\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"Component({\n  properties: {},\n  methods: {\n    onTap: function(){\n      var myEventDetail = {} // detail对象，提供给事件监听函数\n      var myEventOption = {} // 触发事件的选项\n      this.triggerEvent('myevent', myEventDetail, myEventOption)\n    }\n  }\n})\n"})}),"\n",(0,t.jsx)(n.p,{children:"我们接着看输入框输入。"}),"\n",(0,t.jsxs)(n.h2,{id:"7-输入框输入-oninput-函数",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#7-输入框输入-oninput-函数",children:"#"}),"7. 输入框输入 onInput 函数"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:'<input\n    bindinput="onInput"\n/>\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"onInput(event) {\n    debugger;\n    const { value = '' } = event.detail || {};\n    // allow input to be empty\n    if (value === '') {\n        return;\n    }\n    let formatted = this.filter(value);\n    // 限制最大的小数位\n    // limit max decimal length\n    if (isDef(this.data.decimalLength) && formatted.indexOf('.') !== -1) {\n        const pair = formatted.split('.');\n        formatted = `${pair[0]}.${pair[1].slice(0, this.data.decimalLength)}`;\n    }\n    this.emitChange(formatted);\n},\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"8-输入框聚焦失焦",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#8-输入框聚焦失焦",children:"#"}),"8. 输入框聚焦/失焦"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:'<input\n    bind:focus="onFocus"\n    bind:blur="onBlur"\n/>\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"focus"}),"、",(0,t.jsx)(n.code,{children:"blur"}),"事件"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"onFocus(event) {\n    this.$emit('focus', event.detail);\n},\nonBlur(event) {\n    const value = this.format(event.detail.value);\n    this.emitChange(value);\n    this.$emit('blur', Object.assign(Object.assign({}, event.detail), { value }));\n},\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"9-长按加号减号-累计功能",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#9-长按加号减号-累计功能",children:"#"}),"9. 长按加号/减号 累计功能"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:'<view\n    bind:touchstart="onTouchStart"\n    bind:touchend="onTouchEnd"\n></view>\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const LONG_PRESS_START_TIME = 600;\nconst LONG_PRESS_INTERVAL = 200;\nlongPressStep() {\n    this.longPressTimer = setTimeout(() => {\n        this.onChange();\n        this.longPressStep();\n    }, LONG_PRESS_INTERVAL);\n},\nonTouchStart(event) {\n    debugger;\n    // 如果不支持长按，默认支持\n    if (!this.data.longPress) {\n        return;\n    }\n    // 清除定时间\n    clearTimeout(this.longPressTimer);\n    const { type } = event.currentTarget.dataset;\n    this.type = type;\n    this.isLongPress = false;\n    this.longPressTimer = setTimeout(() => {\n        this.isLongPress = true;\n        this.onChange();\n        this.longPressStep();\n    }, LONG_PRESS_START_TIME);\n},\nonTouchEnd() {\n    if (!this.data.longPress) {\n        return;\n    }\n    // 长按结束，清除定时器\n    clearTimeout(this.longPressTimer);\n},\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"10-总结",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#10-总结",children:"#"}),"10. 总结"]}),"\n",(0,t.jsxs)(n.p,{children:["行文至此，就基本接近尾声了。我们从 ",(0,t.jsx)(n.code,{children:"vant-weapp"})," 常用的 ",(0,t.jsx)(n.code,{children:"stepper"})," 步进器组件源码出发。整体源码并不长。"]}),"\n",(0,t.jsxs)(n.p,{children:["我们通过调试方法，分析了整体结构，",(0,t.jsx)(n.code,{children:"VantComponent"})," 函数组件的实现，还有加号减号的功能基本实现，input输入功能、聚焦失焦、还有长按累计的功能等。"]}),"\n",(0,t.jsxs)(n.p,{children:["或许我们自己实现，可能就写的一团糟。所以，相比于原生 ",(0,t.jsx)(n.code,{children:"JS"})," 等源码。我们或许更应该学习，正在使用的组件库的源码，因为有助于帮助我们写业务和写自己的组件。"]}),"\n",(0,t.jsx)(n.p,{children:"不过大多时候，学习源码或许是重要但不紧急的事情。除了公司项目外，我们可以多尝试学习开源项目的源码，从而贡献自己的代码，拥抱开源，会让自己更上一层楼。"}),"\n",(0,t.jsxs)(n.p,{children:["感兴趣的小伙伴，可以克隆我的仓库调试学习 ",(0,t.jsx)(n.a,{href:"https://github.com/ruochuan12/vant-weapp-analysis.git",rel:"noopener noreferrer",target:"_blank",children:"git clone https://github.com/ruochuan12/vant-weapp-analysis.git"}),"。"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"如果看完有收获，欢迎点赞、评论、分享支持。你的支持和肯定，是我写作的动力"}),"~"]}),"\n",(0,t.jsxs)(n.p,{children:["我倾力持续组织了一年",(0,t.jsx)(n.a,{href:"https://juejin.cn/post/7079706017579139102",rel:"noopener noreferrer",target:"_blank",children:"每周大家一起学习200行左右的源码共读活动"}),"，感兴趣的可以",(0,t.jsxs)(n.a,{href:"https://juejin.cn/pin/7217386885793595453",rel:"noopener noreferrer",target:"_blank",children:["点此扫码加我微信 ",(0,t.jsx)(n.code,{children:"ruochuan02"})," 参与"]}),"。"]}),"\n",(0,t.jsxs)(n.p,{children:["另外，想学源码，极力推荐关注我写的专栏",(0,t.jsx)(n.a,{href:"https://juejin.cn/column/6960551178908205093",rel:"noopener noreferrer",target:"_blank",children:"《学习源码整体架构系列》"}),"，目前是掘金关注人数（4.1k+人）第一的专栏，写有20余篇源码文章。包含",(0,t.jsx)(n.code,{children:"jQuery"}),"、",(0,t.jsx)(n.code,{children:"underscore"}),"、",(0,t.jsx)(n.code,{children:"lodash"}),"、",(0,t.jsx)(n.code,{children:"vuex"}),"、",(0,t.jsx)(n.code,{children:"sentry"}),"、",(0,t.jsx)(n.code,{children:"axios"}),"、",(0,t.jsx)(n.code,{children:"redux"}),"、",(0,t.jsx)(n.code,{children:"koa"}),"、",(0,t.jsx)(n.code,{children:"vue-devtools"}),"、",(0,t.jsx)(n.code,{children:"vuex4"}),"、",(0,t.jsx)(n.code,{children:"koa-compose"}),"、",(0,t.jsx)(n.code,{children:"vue 3.2 发布"}),"、",(0,t.jsx)(n.code,{children:"vue-this"}),"、",(0,t.jsx)(n.code,{children:"create-vue"}),"、",(0,t.jsx)(n.code,{children:"玩具vite"}),"、",(0,t.jsx)(n.code,{children:"create-vite"})," 等20余篇源码文章。"]}),"\n",(0,t.jsxs)(n.p,{children:["我正在参与掘金技术社区创作者签约计划招募活动，",(0,t.jsx)(n.a,{href:"https://juejin.cn/post/7112770927082864653",rel:"noopener noreferrer",target:"_blank",children:"点击链接报名投稿"}),"。"]})]})}function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,a.ah)(),e.components);return n?(0,t.jsx)(n,Object.assign({},e,{children:(0,t.jsx)(c,e)})):c(e)}let h=o;o.__RSPRESS_PAGE_META={},o.__RSPRESS_PAGE_META["vant-weapp-stepper%2Findex.md"]={toc:[{id:"1-前言",text:"1. 前言",depth:2},{id:"2-stepper-步进器",text:"2. stepper 步进器",depth:2},{id:"3-克隆项目--调试",text:"3. 克隆项目 && 调试",depth:2},{id:"4-整体结构",text:"4. 整体结构",depth:2},{id:"41-组件的-wxml-结构",text:"4.1 组件的 wxml 结构",depth:3},{id:"42-组件的-js-结构",text:"4.2 组件的 JS 结构",depth:3},{id:"43-vantcomponent-组件",text:"4.3 VantComponent 组件",depth:3},{id:"431-behavior-如同-mixins",text:"4.3.1 Behavior 如同 mixins",depth:4},{id:"5-组件初始化",text:"5. 组件初始化",depth:2},{id:"6-点击加号减号",text:"6. 点击加号/减号",depth:2},{id:"61-ontap-函数",text:"6.1 onTap 函数",depth:3},{id:"62-onchange-函数",text:"6.2 onChange 函数",depth:3},{id:"63-isdisabled-函数",text:"6.3 isDisabled 函数",depth:3},{id:"64-emitchange-函数",text:"6.4 emitChange 函数",depth:3},{id:"65-emit-函数",text:"6.5 $emit 函数",depth:3},{id:"7-输入框输入-oninput-函数",text:"7. 输入框输入 onInput 函数",depth:2},{id:"8-输入框聚焦失焦",text:"8. 输入框聚焦/失焦",depth:2},{id:"9-长按加号减号-累计功能",text:"9. 长按加号/减号 累计功能",depth:2},{id:"10-总结",text:"10. 总结",depth:2}],title:"经常用 vant-weapp 开发小程序，却不知道如何开发一个组件？",headingTitle:"经常用 vant-weapp 开发小程序，却不知道如何开发一个组件？",frontmatter:{highlight:"darcula",theme:"smartblue"}}},20713:function(e,n,s){s.d(n,{Z:()=>l});var t=s(52676),a=s(75271),r=s(92815);s(18544);let i={"zh-CN":e=>`\u{9884}\u{8BA1}\u{9605}\u{8BFB}\u{65F6}\u{95F4}: ${e.minutes>=1?`${Math.ceil(e.minutes)} \u{5206}\u{949F}`:"小于 1 分钟"}`,"en-US":e=>`Estimated reading time: ${e.minutes>=1?`${Math.ceil(e.minutes)} minutes`:"less than 1 minute"}`};function d(e,n,s){let t=Object.keys(i).includes(n)?n:s;return i[t](e)}let l=e=>{let{defaultLocale:n="en-US"}=e,s=(0,r.Vi)().page.readingTimeData,i=(0,r.Jr)(),l=(0,r.e7)(),[c,o]=(0,a.useState)(d(s,i,n));return(0,a.useEffect)(()=>{o(d(s,i,n))},[i,s]),(0,t.jsx)("span",{"data-dark":String(l),className:"rp-reading-time",children:c})}}}]);