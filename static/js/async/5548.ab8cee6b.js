"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([["5548"],{46257:function(e,n,r){r.r(n),r.d(n,{default:()=>o});var i=r(52676),l=r(40453),s=r(20713);function a(e){let n=Object.assign({h1:"h1",a:"a",h2:"h2",p:"p",code:"code",ol:"ol",li:"li",pre:"pre",h3:"h3"},(0,l.ah)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.h1,{id:"vite-那些常用的小技巧",children:[(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#vite-那些常用的小技巧",children:"#"}),"vite 那些常用的小技巧"]}),"\n",(0,i.jsx)(s.Z,{defaultLocale:"zh-CN"}),"\n",(0,i.jsxs)(n.h2,{id:"1-前言",children:[(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1-前言",children:"#"}),"1. 前言"]}),"\n",(0,i.jsxs)(n.p,{children:["大家好，我是",(0,i.jsx)(n.a,{href:"https://ruochuan12.github.io",rel:"noopener noreferrer",target:"_blank",children:"若川"}),"，欢迎 ",(0,i.jsx)(n.code,{children:"follow"})," ",(0,i.jsx)(n.a,{href:"https://github.com/ruochuan12",rel:"noopener noreferrer",target:"_blank",children:"我的 github"}),"。我倾力持续组织了一年多",(0,i.jsx)(n.a,{href:"https://juejin.cn/post/7079706017579139102",rel:"noopener noreferrer",target:"_blank",children:"每周大家一起学习200行左右的源码共读活动"}),"，感兴趣的可以",(0,i.jsxs)(n.a,{href:"https://juejin.cn/pin/7217386885793595453",rel:"noopener noreferrer",target:"_blank",children:["点此扫码加我微信 ",(0,i.jsx)(n.code,{children:"ruochuan02"})," 参与"]}),"。另外，想学源码，极力推荐关注我写的专栏",(0,i.jsx)(n.a,{href:"https://juejin.cn/column/6960551178908205093",rel:"noopener noreferrer",target:"_blank",children:"《学习源码整体架构系列》"}),"，目前是掘金关注人数（5.7k+人）第一的专栏，写有20余篇源码文章。"]}),"\n",(0,i.jsx)(n.p,{children:"我常建议大家公司项目之外，有时间也可以多参与开源项目。"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["分析的打包依赖大小","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"配置命令到 package.json"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"echarts 按需引入"}),"\n",(0,i.jsx)(n.li,{}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"初始化项目"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm init vite\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"环境准备",children:[(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#环境准备",children:"#"}),"环境准备"]}),"\n",(0,i.jsxs)(n.h2,{id:"viteconfigts-配置",children:[(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#viteconfigts-配置",children:"#"}),"vite.config.ts 配置"]}),"\n",(0,i.jsxs)(n.h2,{id:"配置别名",children:[(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#配置别名",children:"#"}),"配置别名"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"{\n  resolve: {\n    // 起个别名，在引用资源时，可以用‘@/资源路径’直接访问\n    alias: {\n      '@': _resolve('src'),\n    },\n  },\n}\n"})}),"\n",(0,i.jsxs)(n.h2,{id:"生产环境-移除-consolelogdebugger",children:[(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#生产环境-移除-consolelogdebugger",children:"#"}),"生产环境 移除 console.log、debugger"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"{\n  esbuild: {\n    drop: mode === 'production' ? ['console', 'debugger'] : [],\n  },\n}\n"})}),"\n",(0,i.jsxs)(n.h2,{id:"打包分析依赖大小",children:[(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#打包分析依赖大小",children:"#"}),"打包分析依赖大小"]}),"\n",(0,i.jsx)(n.p,{children:"用过 webpack 的小伙伴都知道，有一个很好用的打包文件可视化分析的插件，webpack-bundle-analyzer"}),"\n",(0,i.jsx)(n.p,{children:"rollup-plugin-bundle-analyzer"}),"\n",(0,i.jsxs)(n.h3,{id:"rollup-plugin-bundle-analyzer",children:[(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#rollup-plugin-bundle-analyzer",children:"#"}),"rollup-plugin-bundle-analyzer"]}),"\n",(0,i.jsxs)(n.h3,{id:"rollup-plugin-visualizer",children:[(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#rollup-plugin-visualizer",children:"#"}),"rollup-plugin-visualizer"]}),"\n",(0,i.jsx)(n.p,{children:"但每次打包编译都打开输出页面，也是不合适。\n所以这时我们考虑加个命令行的参数。"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm run build:report\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "build:report": "tsc && vite build -- report",\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["vite 源码用的是 ",(0,i.jsx)(n.a,{href:"https://github.com/cacjs/cac",rel:"noopener noreferrer",target:"_blank",children:"cac"})," 。会报错。"]}),"\n",(0,i.jsx)(n.p,{children:"minimist 解析命令行参数"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://github.com/vitejs/vite/discussions/7920",rel:"noopener noreferrer",target:"_blank",children:"How to remove console.log ,when vite build use esbuild? #7920"})}),"\n",(0,i.jsx)(n.p,{children:"行文至此，文章接近尾声。\n完整代码。方便读者朋友们复制粘贴。"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"import { defineConfig, loadEnv } from 'vite';\nimport react from '@vitejs/plugin-react';\nimport { dirname, resolve } from 'path';\nimport { fileURLToPath } from 'url';\nimport bundleAnalyzer from 'rollup-plugin-bundle-analyzer';\nimport { visualizer } from 'rollup-plugin-visualizer';\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\nimport minimist from 'minimist';\n\nfunction _resolve(dir: string) {\n  return resolve(__dirname, dir);\n}\n\nconst params = process.argv.slice(2);\nconst paramsDefault = {\n  default: {\n    report: false,\n  },\n  boolean: ['report'],\n};\n\nconst args = minimist(params);\nlet report = false;\ntry {\n  report = params.includes('report');\n} catch (e) {\n  console.log('parse custom params error', e);\n}\n\nconsole.log(params, args, report, paramsDefault);\n\n// https://vitejs.dev/config/\nexport default defineConfig(({ mode }) => {\n  // 根据当前工作目录中的 `mode` 加载 .env 文件\n  // 设置第三个参数为 '' 来加载所有环境变量，而不管是否有 `VITE_` 前缀。\n  const env = loadEnv(mode, process.cwd(), '');\n  const plugins = !report\n    ? []\n    : [\n        bundleAnalyzer({\n          port: 9800,\n          openBrowser: true,\n        }),\n        visualizer({\n          gzipSize: true,\n          brotliSize: true,\n          emitFile: false,\n          filename: 'report.html', //分析图生成的文件名\n          open: true, //如果存在本地服务端口，将在打包后自动展示\n        }),\n      ];\n  // console.log('env', env);\n  return {\n    // 起个别名，在引用资源时，可以用‘@/资源路径’直接访问\n    resolve: {\n      alias: {\n        '@': _resolve('src'),\n      },\n    },\n    // vite 配置\n    define: {\n      // __APP_ENV__: JSON.stringify(env.APP_ENV),\n      BASE_URL: JSON.stringify(env.VITE_BASE_URL),\n      __DEV__: JSON.stringify(env.NODE_ENV === 'development'),\n    },\n    plugins: [react(), ...plugins],\n    // https://cn.vitejs.dev/config/server-options.html#server-proxy\n    // server.cors\n    server: {\n      cors: true,\n      proxy: {\n        '/api': {\n          target: 'https://ruochuan12.github.io',\n          changeOrigin: true,\n          rewrite: (path) => path.replace(/^\\/api/, ''),\n        },\n      },\n    },\n    esbuild: {\n      drop: mode === 'production' ? ['console', 'debugger'] : [],\n    },\n  };\n});\n\n"})}),"\n",(0,i.jsxs)(n.h2,{id:"8-加源码共读交流群",children:[(0,i.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#8-加源码共读交流群",children:"#"}),"8. 加源码共读交流群"]}),"\n",(0,i.jsxs)(n.p,{children:["最后可以持续关注我",(0,i.jsx)(n.a,{href:"https://juejin.cn/user/1415826704971918",rel:"noopener noreferrer",target:"_blank",children:"@若川"}),"，欢迎 ",(0,i.jsx)(n.code,{children:"follow"})," ",(0,i.jsx)(n.a,{href:"https://github.com/ruochuan12",rel:"noopener noreferrer",target:"_blank",children:"我的 github"}),"。另外，想学源码，极力推荐关注我写的专栏",(0,i.jsx)(n.a,{href:"https://juejin.cn/column/6960551178908205093",rel:"noopener noreferrer",target:"_blank",children:"《学习源码整体架构系列》"}),"，目前是掘金关注人数（5.7k+人）第一的专栏，写有20余篇源码文章。"]}),"\n",(0,i.jsxs)(n.p,{children:["我倾力持续组织了一年多",(0,i.jsx)(n.a,{href:"https://juejin.cn/post/7079706017579139102",rel:"noopener noreferrer",target:"_blank",children:"每周大家一起学习200行左右的源码共读活动"}),"，感兴趣的可以",(0,i.jsxs)(n.a,{href:"https://juejin.cn/pin/7217386885793595453",rel:"noopener noreferrer",target:"_blank",children:["点此扫码加我微信 ",(0,i.jsx)(n.code,{children:"ruochuan02"})," 参与"]}),"。"]})]})}function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,l.ah)(),e.components);return n?(0,i.jsx)(n,Object.assign({},e,{children:(0,i.jsx)(a,e)})):a(e)}let o=t;t.__RSPRESS_PAGE_META={},t.__RSPRESS_PAGE_META["vite-report%2Findex.md"]={toc:[{id:"1-前言",text:"1. 前言",depth:2},{id:"环境准备",text:"环境准备",depth:3},{id:"viteconfigts-配置",text:"vite.config.ts 配置",depth:2},{id:"配置别名",text:"配置别名",depth:2},{id:"生产环境-移除-consolelogdebugger",text:"生产环境 移除 console.log、debugger",depth:2},{id:"打包分析依赖大小",text:"打包分析依赖大小",depth:2},{id:"rollup-plugin-bundle-analyzer",text:"rollup-plugin-bundle-analyzer",depth:3},{id:"rollup-plugin-visualizer",text:"rollup-plugin-visualizer",depth:3},{id:"8-加源码共读交流群",text:"8. 加源码共读交流群",depth:2}],title:"vite 那些常用的小技巧",headingTitle:"vite 那些常用的小技巧",frontmatter:{}}},20713:function(e,n,r){r.d(n,{Z:()=>o});var i=r(52676),l=r(75271),s=r(92815);r(18544);let a={"zh-CN":e=>`\u{9884}\u{8BA1}\u{9605}\u{8BFB}\u{65F6}\u{95F4}: ${e.minutes>=1?`${Math.ceil(e.minutes)} \u{5206}\u{949F}`:"小于 1 分钟"}`,"en-US":e=>`Estimated reading time: ${e.minutes>=1?`${Math.ceil(e.minutes)} minutes`:"less than 1 minute"}`};function t(e,n,r){let i=Object.keys(a).includes(n)?n:r;return a[i](e)}let o=e=>{let{defaultLocale:n="en-US"}=e,r=(0,s.Vi)().page.readingTimeData,a=(0,s.Jr)(),o=(0,s.e7)(),[c,d]=(0,l.useState)(t(r,a,n));return(0,l.useEffect)(()=>{d(t(r,a,n))},[a,r]),(0,i.jsx)("span",{"data-dark":String(o),className:"rp-reading-time",children:c})}}}]);