"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([["6579"],{60332:function(e,n,r){e.exports=r.p+"static/image/wechat-official-accounts-mini.44481959.png"},74531:function(e,n,r){r.r(n),r.d(n,{default:()=>d});var s=r(52676),i=r(40453),a=r(20713),c=r(60332);function l(e){let n=Object.assign({h1:"h1",a:"a",blockquote:"blockquote",p:"p",code:"code",h2:"h2",pre:"pre",strong:"strong",img:"img"},(0,i.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"vue-2x项目-vue-qriously-生成二维码并下载cliploard复制粘贴",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#vue-2x项目-vue-qriously-生成二维码并下载cliploard复制粘贴",children:"#"}),"vue 2.x项目 vue-qriously 生成二维码并下载、cliploard复制粘贴"]}),"\n",(0,s.jsx)(a.Z,{defaultLocale:"zh-CN"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"写于2018年05月15日"})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["近日，重构项目某一老模块时，有一个功能是生成二维码并下载，还可以复制链接。列表每项都有二维码、下载二维码和复制链接和列表上方总的二维码。\n老模块是用的",(0,s.jsx)(n.a,{href:"http://code.ciaoca.com/javascript/qrcode/",rel:"noopener noreferrer",target:"_blank",children:"qrocode中文文档"}),"，",(0,s.jsx)(n.a,{href:"https://github.com/davidshimjs/qrcodejs",rel:"noopener noreferrer",target:"_blank",children:"qrcode github"}),"。"]}),"\n",(0,s.jsxs)(n.p,{children:["先想着新模块中是否有生成二维码的插件，看了下",(0,s.jsx)(n.code,{children:"package.json"}),"。\n有安装一个",(0,s.jsx)(n.a,{href:"https://github.com/theomessin/vue-qriously",rel:"noopener noreferrer",target:"_blank",children:"vue-qriously"}),"。但搜索了一下，竟然没有使用，可能是因为很多二维码都是后端生成返回链接给前端的。而在其他H5、微信项目中使用了。看了下这个项目",(0,s.jsx)(n.code,{children:"star"}),"数是",(0,s.jsx)(n.code,{children:"113"}),"。但我不想重新引入老模块的",(0,s.jsx)(n.code,{children:"qrcodejs"}),"，重新引入其他的二维码插件，相对比较麻烦。于是就保持统一用",(0,s.jsx)(n.code,{children:"vue-qriously"}),"了。\n猜想当时引入这个是",(0,s.jsxs)(n.a,{href:"https://github.com/vuejs/awesome-vue",rel:"noopener noreferrer",target:"_blank",children:["vue 资源合集",(0,s.jsx)(n.code,{children:"awesome-vue"})]}),"中，",(0,s.jsx)(n.code,{children:"qrcode"}),"相关第一个就是",(0,s.jsx)(n.code,{children:"vue-qriously"}),"。"]}),"\n",(0,s.jsxs)(n.h2,{id:"vue-qriously插件使用",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#vue-qriously插件使用",children:"#"}),(0,s.jsx)(n.code,{children:"vue-qriously"}),"插件使用"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// 入口js文件\n// npm install vue-qriously -S\nimport Vue from 'vue';\nimport VueQriously from 'vue-qriously';\nVue.use(VueQriously);\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'// vue 文件\n<template>\n    <qriously :value="value" size="size" :backgroundAlpha="backgroundAlpha"/>\n</template>\n\n<script>\nexport default {\n    name: \'app\',\n    data(){\n        return {\n            // 可以自定义，必填项。\n            value: \'http://ruochuan12.github.io/\',\n            // 二维码大小 默认 100\n            size: 80,\n            // 背景透明度，默认透明 0\n            backgroundAlpha： 1,\n        }\n    }\n}\n<\/script>\n'})}),"\n",(0,s.jsxs)(n.p,{children:["更多参数配置可以查看：",(0,s.jsx)(n.a,{href:"https://github.com/theomessin/vue-qriously/blob/master/src/components/v-qriously.vue",rel:"noopener noreferrer",target:"_blank",children:"github 仓库 v-qriously.vue源码"}),"\n查看代码可以发现，开头引用了",(0,s.jsx)(n.code,{children:"qrious"}),"，这个",(0,s.jsx)(n.code,{children:"star"}),"就多一点，",(0,s.jsx)(n.code,{children:"600"}),"多。"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"import Qrious from 'qrious'\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsxs)(n.a,{href:"https://github.com/neocotic/qrious",rel:"noopener noreferrer",target:"_blank",children:[(0,s.jsx)(n.code,{children:"qrious"})," github 地址"]}),"\n",(0,s.jsxs)(n.a,{href:"https://neocotic.com/qrious/",rel:"noopener noreferrer",target:"_blank",children:[(0,s.jsx)(n.code,{children:"qrious"})," 文档"]})]}),"\n",(0,s.jsxs)(n.h2,{id:"下载二维码",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#下载二维码",children:"#"}),"下载二维码"]}),"\n",(0,s.jsxs)(n.p,{children:["粗略的翻看下以上相关文档，写完正准备要做下载功能。这时发现，哎呀，竟然就是只生成了一个",(0,s.jsx)(n.code,{children:"canvas"}),"。\n于是百度(暴露了用百度...我也想用谷歌，但现在不行...)了下",(0,s.jsx)(n.code,{children:"canvas"}),"如何转图片。\n",(0,s.jsx)(n.a,{href:"https://stackoverflow.com/questions/923885/capture-html-canvas-as-gif-jpg-png-pdf",rel:"noopener noreferrer",target:"_blank",children:"stackoverflow Capture HTML Canvas as gif/jpg/png/pdf?"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'var canvas = document.getElementById("mycanvas");\nvar imgSrc    = canvas.toDataURL("image/png");\ndocument.write(\'<img src="\'+img+\'"/>\');\n// 搜索到一些其他的方案，感觉挺麻烦。\n// 嗯，这个简单。想着我们项目兼容性没什么要求，于是就用这个了。\n'})}),"\n",(0,s.jsxs)(n.p,{children:["生成了",(0,s.jsx)(n.code,{children:"img"}),"的",(0,s.jsx)(n.code,{children:"src"}),"资源，那么就可以下载了。"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// 老模块是用的`jquery` + `seajs` + `vue1.x`\n// 新模块尽量要去除`jquery`。\nlet src = $('.img').src;\nlet aLink = $('<a></a>').attr('href', src).attr('download', 'xxx二维码.png').appendTo('body');\naLink[0].click();\naLink.remove();\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// 新模块 去除jquery\nlet elem = document.createElement('a');\nelem.setAttribute('href', imgSrc);\nelem.setAttribute('download', 'xxx二维码.png');\ndocument.body.appendChild(elem);\nelem.click();\ndocument.body.removeChild(elem);\n"})}),"\n",(0,s.jsxs)(n.p,{children:["但这样写也相对比较麻烦。\n项目中封装了一个",(0,s.jsx)(n.code,{children:"v-click"}),"指令。"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"/**\n * vClick 触发点击\n * @type {Object}\n */\nexport const vClick = {\n	directives: {\n		click: {\n			/**\n			 * 值更新时候触发点击\n			 * @author 若川 <lxchuan12@163.com>\n			 * @date   2018-05-15\n			 * @param  {HTMLElement} el                指令所绑定的元素\n			 * @param  {Boolean}     options.value     绑定值(新)\n			 * @param  {Boolean}     options.oldValue  绑定值(旧)\n			 */\n			update(el, { value, oldValue }){\n				if(value && !oldValue){\n					el.click();\n				}\n			},\n		},\n	},\n};\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'<template>\n<div>\n    <div class="img" v-show="listShareShow">\n        <qriously id="qriously" :backgroundAlpha="1" :value="listSharingLink" :size="160" v-show="false"/>\n        <img :src="listSharingLinkSrc" alt="xxx二维码">\n    </div>\n    <a :href="exportLink" v-click="download" :download="downloadFilename"></a>\n    <a  @click.stop="listShare">查看链接/二维码</a>\n</div>\n</template>\n<script>\nexport default {\n    // 提取出主要代码\n    data(){\n        retrun {\n            // 下载\n			download: false,\n			downloadFilename: \'xxx二维码\',\n			listSharingLinkSrc: \'\',\n            listSharingLinkSrc: \'\',\n            listShareShow: false,\n        }\n    },\n    // ...\n    methods: {\n        /**\n		 * 查看链接/二维码\n		 * @author 若川 <lxchuan12@163.com>\n		 * @date   2018-05-15\n		 */\n		listShare(event){\n			if(!this.listSharingLinkSrc){\n				let canvas = document.querySelector(\'#qriously canvas\');\n				let imgSrc = canvas.toDataURL(\'image/png\');\n				this.listSharingLinkSrc = imgSrc;\n			}\n			this.listShareShow = !this.listShareShow;\n		},\n        /**\n		 * 表格上方：下载二维码列表\n		 * @author 若川 <lxchuan12@163.com>\n		 * @date   2018-05-15\n		 */\n		downloadQrcode(event, linkSrc, downloadFilename){\n			event.stopPropagation();\n			this.exportLink = linkSrc;\n			this.downloadFilename = downloadFilename;\n			this.download = true;\n			this.$nextTick(() => {\n				this.exportLink = \'\';\n				this.download = false;\n				this.downloadFilename = \'\';\n			});\n		},\n    },\n};\n<\/script>\n'})}),"\n",(0,s.jsxs)(n.p,{children:["代码写到这里，嗯，实现完了下载。但又发现又一需求，显示大小是",(0,s.jsx)(n.code,{children:"80 * 80"}),"，下载需要是",(0,s.jsx)(n.code,{children:"160 * 160"}),"。"]}),"\n",(0,s.jsxs)(n.h2,{id:"显示大小和下载大小不一样",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#显示大小和下载大小不一样",children:"#"}),"显示大小和下载大小不一样"]}),"\n",(0,s.jsxs)(n.p,{children:["参考了下老模块，",(0,s.jsx)(n.code,{children:"qrcodejs"}),"渲染出来的",(0,s.jsx)(n.code,{children:"html"}),","]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'//  跟这个类似\n<div id="qrcode_1" title="your content">\n    <canvas width="256" height="256" style="display: none;"></canvas>\n    <img alt="Scan me!" style="display: block;" src="data:image/png;base64,xxx">\n</div>\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"vue-qriously"}),"渲染出来是"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'<div>\n    <canvas width="80" width="80"></canvas>\n</div>\n'})}),"\n",(0,s.jsxs)(n.p,{children:["于是我可以把生成的",(0,s.jsx)(n.code,{children:"imgSrc"}),"资源,"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'<template>\n<div>\n    <canvas width="160" width="160" v-show="false"></canvas>\n    <img class="img" :src="imgSrc"/>\n</div>\n</template>\n<style lang="less">\n.img{\n    width: 80px;\n    height: 80px;\n}\n</style>\n'})}),"\n",(0,s.jsxs)(n.p,{children:["这就实现了下载的资源是",(0,s.jsx)(n.code,{children:"160 * 160"}),"，用样式控制图片显示",(0,s.jsx)(n.code,{children:"80 * 80"}),"。\n代码写完，觉得应该给",(0,s.jsx)(n.code,{children:"vue-qriously"}),"写个",(0,s.jsx)(n.code,{children:"pr"}),",实现 不仅仅是渲染",(0,s.jsx)(n.code,{children:"canvas"}),"，而是让大家可以选择时",(0,s.jsx)(n.code,{children:"img"}),"还是",(0,s.jsx)(n.code,{children:"canvas"}),"。又去翻了翻这个项目的",(0,s.jsx)(n.code,{children:"issue"}),",有一个",(0,s.jsx)(n.code,{children:"issue"}),(0,s.jsx)(n.a,{href:"https://github.com/theomessin/vue-qriously/issues/10",rel:"noopener noreferrer",target:"_blank",children:"链接：how to make this canvas exchange to img"})," 就是说的这个。还没关闭。"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"i think u can create type let user select img and canvas.\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"// 有一个回复\nIf you want to make it become downloadable, maybe you can transform it from canvas easily by canvas.toDataURL()\n"})}),"\n",(0,s.jsxs)(n.p,{children:["文章写到这里，我发现这样似乎不太妥。我的场景，是点击时显示浮层（浮层有二维码和复制链接地址和下载二维码按钮等），获取",(0,s.jsx)(n.code,{children:"canvas"}),"元素，去转成",(0,s.jsx)(n.code,{children:"img"})," ",(0,s.jsx)(n.code,{children:"src"}),"，再去渲染到页面，而且图片可能会闪，因为是实际大小是",(0,s.jsx)(n.code,{children:"160"}),"，样式强制控制在",(0,s.jsx)(n.code,{children:"80"}),"。\n何不生成两份，一份是用来获取资源下载的。一份用来显示的。嗯，之后去优化下。\n顺带说一下，复制粘贴"]}),"\n",(0,s.jsxs)(n.h2,{id:"cliploard-复制粘贴",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#cliploard-复制粘贴",children:"#"}),"cliploard 复制粘贴"]}),"\n",(0,s.jsxs)(n.p,{children:["老模块中是用的",(0,s.jsx)(n.code,{children:"cliploard"}),(0,s.jsx)(n.a,{href:"https://github.com/zenorocha/clipboard.js",rel:"noopener noreferrer",target:"_blank",children:"clipboard github仓库"}),"。就是我引入的。"]}),"\n",(0,s.jsx)(n.p,{children:"新模块还没使用过，但依然使用这个。"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// 安装\n// npm install clipboard --save\n<template @click=\"Clip($event, '快来复制')\"><template>\n// 封装成一个函数\nimport Clipboard from 'clipboard';\nexport default function Clip(event，text) {\n  const clipboard = new Clipboard(event.target, {\n    text: () => text\n  });\n  clipboard.on('success', () => {\n    console.log('复制成功');\n    clipboard.off('error');\n    clipboard.off('success');\n    clipboard.destroy();\n  });\n  clipboard.on('error', () => {\n    console.log('复制失败，请刷新试试');\n    clipboard.off('error')\n    clipboard.off('success')\n    clipboard.destroy()\n  });\n  clipboard.onClick(event);\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["当然也可以封装成",(0,s.jsx)(n.code,{children:"vue"}),"指令。\n可以参考",(0,s.jsx)(n.a,{href:"https://github.com/PanJiaChen/vue-element-admin",rel:"noopener noreferrer",target:"_blank",children:"vue-element-admin这个项目"}),"\n之前我看的时候还是",(0,s.jsx)(n.code,{children:"3000"}),"多",(0,s.jsx)(n.code,{children:"star"}),"，现在",(0,s.jsx)(n.code,{children:"1.2w+"}),"，说明值得学习。\n另外推荐",(0,s.jsxs)(n.a,{href:"https://www.awesomes.cn/",rel:"noopener noreferrer",target:"_blank",children:[(0,s.jsx)(n.code,{children:"awesomes"}),"网站 工具类库合集"]})]}),"\n",(0,s.jsxs)(n.h2,{id:"小结",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#小结",children:"#"}),"小结"]}),"\n",(0,s.jsxs)(n.p,{children:["1、引入第三方插件等使用时，多查看",(0,s.jsx)(n.code,{children:"github"})," 文档 ",(0,s.jsx)(n.code,{children:"issue"}),"等，在技术社区搜索别人使用的方案。","\n2、选用第三方插件时，尽可能挑选",(0,s.jsx)(n.code,{children:"star"}),"比较多的，",(0,s.jsx)(n.code,{children:"issue"}),"处理比较及时的，在更新维护的。","\n3、富余时间可以多研究下别人的项目是如何组织文件，和实现的一些常用功能的。","\n4、尽可能去优化自己的代码，总结回顾。"]}),"\n",(0,s.jsxs)(n.h2,{id:"关于",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#关于",children:"#"}),"关于"]}),"\n",(0,s.jsxs)(n.p,{children:["作者：常以",(0,s.jsx)(n.strong,{children:"若川"}),"为名混迹于江湖。前端路上 | PPT爱好者 | 所知甚少，唯善学。","\n",(0,s.jsx)(n.a,{href:"https://ruochuan12.github.io/",rel:"noopener noreferrer",target:"_blank",children:"个人博客"}),"\n",(0,s.jsx)(n.a,{href:"https://juejin.im/user/1415826704971918/posts",rel:"noopener noreferrer",target:"_blank",children:"掘金专栏"}),"，欢迎关注~","\n",(0,s.jsxs)(n.a,{href:"https://segmentfault.com/blog/lxchuan12",rel:"noopener noreferrer",target:"_blank",children:[(0,s.jsx)(n.code,{children:"segmentfault"}),"前端视野专栏"]}),"，开通了",(0,s.jsx)(n.strong,{children:"前端视野"}),"专栏，欢迎关注~","\n",(0,s.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/lxchuan12",rel:"noopener noreferrer",target:"_blank",children:"知乎前端视野专栏"}),"，开通了",(0,s.jsx)(n.strong,{children:"前端视野"}),"专栏，欢迎关注~","\n",(0,s.jsx)(n.a,{href:"https://github.com/ruochuan12/blog",rel:"noopener noreferrer",target:"_blank",children:"github blog"}),"，相关源码和资源都放在这里，求个",(0,s.jsx)(n.code,{children:"star"}),"^_^~"]}),"\n",(0,s.jsxs)(n.h2,{id:"微信公众号--若川视野",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#微信公众号--若川视野",children:"#"}),"微信公众号  若川视野"]}),"\n",(0,s.jsxs)(n.p,{children:["可能比较有趣的微信公众号，长按扫码关注。也可以加微信 ",(0,s.jsx)(n.code,{children:"ruochuan12"}),"，注明来源，拉您进【前端视野交流群】。"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"若川视野",src:c})})]})}function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,s.jsx)(n,Object.assign({},e,{children:(0,s.jsx)(l,e)})):l(e)}let d=o;o.__RSPRESS_PAGE_META={},o.__RSPRESS_PAGE_META["vue-2-qrcode%2Findex.md"]={toc:[{id:"vue-qriously插件使用",text:"`vue-qriously`插件使用",depth:2},{id:"下载二维码",text:"下载二维码",depth:2},{id:"显示大小和下载大小不一样",text:"显示大小和下载大小不一样",depth:2},{id:"cliploard-复制粘贴",text:"cliploard 复制粘贴",depth:2},{id:"小结",text:"小结",depth:2},{id:"关于",text:"关于",depth:2},{id:"微信公众号--若川视野",text:"微信公众号  若川视野",depth:2}],title:"vue 2.x项目 vue-qriously 生成二维码并下载、cliploard复制粘贴",headingTitle:"vue 2.x项目 vue-qriously 生成二维码并下载、cliploard复制粘贴",frontmatter:{}}},20713:function(e,n,r){r.d(n,{Z:()=>o});var s=r(52676),i=r(75271),a=r(92815);r(18544);let c={"zh-CN":e=>`\u{9884}\u{8BA1}\u{9605}\u{8BFB}\u{65F6}\u{95F4}: ${e.minutes>=1?`${Math.ceil(e.minutes)} \u{5206}\u{949F}`:"小于 1 分钟"}`,"en-US":e=>`Estimated reading time: ${e.minutes>=1?`${Math.ceil(e.minutes)} minutes`:"less than 1 minute"}`};function l(e,n,r){let s=Object.keys(c).includes(n)?n:r;return c[s](e)}let o=e=>{let{defaultLocale:n="en-US"}=e,r=(0,a.Vi)().page.readingTimeData,c=(0,a.Jr)(),o=(0,a.e7)(),[d,t]=(0,i.useState)(l(r,c,n));return(0,i.useEffect)(()=>{t(l(r,c,n))},[c,r]),(0,s.jsx)("span",{"data-dark":String(o),className:"rp-reading-time",children:d})}}}]);