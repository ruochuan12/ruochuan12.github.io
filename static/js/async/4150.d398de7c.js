"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([["4150"],{9777:function(e,n,r){r.r(n),r.d(n,{default:()=>p});var s=r(52676),l=r(40453),a=r(20713);let o=r.p+"static/image/debugger.6a61189c.png",t=r.p+"static/image/error.17935039.png";function i(e){let n=Object.assign({h1:"h1",a:"a",h2:"h2",blockquote:"blockquote",p:"p",code:"code",pre:"pre",strong:"strong",h3:"h3",img:"img"},(0,l.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"从-vue3-和-vite-源码中我学到了一行代码统一规范团队包管理器的神器",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#从-vue3-和-vite-源码中我学到了一行代码统一规范团队包管理器的神器",children:"#"}),"从 vue3 和 vite 源码中，我学到了一行代码统一规范团队包管理器的神器"]}),"\n",(0,s.jsx)(a.Z,{defaultLocale:"zh-CN"}),"\n",(0,s.jsxs)(n.h2,{id:"1-前言",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1-前言",children:"#"}),"1. 前言"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["大家好，我是",(0,s.jsx)(n.a,{href:"https://ruochuan12.github.io",rel:"noopener noreferrer",target:"_blank",children:"若川"}),"。最近组织了",(0,s.jsx)(n.a,{href:"https://juejin.cn/pin/7005372623400435725",rel:"noopener noreferrer",target:"_blank",children:"源码共读活动"}),"，感兴趣的可以加我微信 ",(0,s.jsx)(n.a,{href:"https://juejin.cn/pin/7005372623400435725",rel:"noopener noreferrer",target:"_blank",children:"ruochuan12"})," 参与，或者关注我的",(0,s.jsx)(n.a,{href:"https://ruochuan12.github.io",rel:"noopener noreferrer",target:"_blank",children:"公众号若川视野"}),"，回复“源码”参与。已进行三个月，大家一起交流学习，共同进步，很多人都表示收获颇丰。"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["想学源码，极力推荐之前我写的",(0,s.jsx)(n.a,{href:"https://juejin.cn/column/6960551178908205093",rel:"noopener noreferrer",target:"_blank",children:"《学习源码整体架构系列》"})," 包含",(0,s.jsx)(n.code,{children:"jQuery"}),"、",(0,s.jsx)(n.code,{children:"underscore"}),"、",(0,s.jsx)(n.code,{children:"lodash"}),"、",(0,s.jsx)(n.code,{children:"vuex"}),"、",(0,s.jsx)(n.code,{children:"sentry"}),"、",(0,s.jsx)(n.code,{children:"axios"}),"、",(0,s.jsx)(n.code,{children:"redux"}),"、",(0,s.jsx)(n.code,{children:"koa"}),"、",(0,s.jsx)(n.code,{children:"vue-devtools"}),"、",(0,s.jsx)(n.code,{children:"vuex4"}),"、",(0,s.jsx)(n.code,{children:"koa-compose"}),"、",(0,s.jsx)(n.code,{children:"vue 3.2 发布"}),"、",(0,s.jsx)(n.code,{children:"vue-this"}),"、",(0,s.jsx)(n.code,{children:"create-vue"}),"、",(0,s.jsx)(n.code,{children:"玩具vite"}),"等10余篇源码文章。"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/ruochuan12/only-allow-analysis.git",rel:"noopener noreferrer",target:"_blank",children:"本文仓库 only-allow-analysis，求个star^_^"})}),"\n",(0,s.jsxs)(n.p,{children:["最近组织了",(0,s.jsx)(n.a,{href:"https://juejin.cn/pin/7005372623400435725",rel:"noopener noreferrer",target:"_blank",children:"源码共读活动"}),"，每周大家一起学习200行左右的源码。每周一期，已进行到14期。于是搜寻各种值得我们学习，且代码行数不多的源码。"]}),"\n",(0,s.jsx)(n.p,{children:"阅读本文，你将学到："}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'1. 如何学习调试源码\n2. 学会 npm 钩子\n3. 学会 "preinstall": "npx only-allow pnpm" 一行代码统一规范包管理器\n4. 学到 only-allow 原理\n5. 等等\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"2-场景",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2-场景",children:"#"}),"2. 场景"]}),"\n",(0,s.jsxs)(n.p,{children:["我们项目开发时，常需要安装依赖，虽说一般用文档可以说明。但不是比较强制的约束。是人就容易犯错或者疏忽，假如规定是用的",(0,s.jsx)(n.code,{children:"npm"}),"，而团队里有人某一天不小心使用了其他包管理器安装了的其他依赖，上传了代码，严重时可能导致线上问题。所以我们需要借助工具（代码）来强制约束。"]}),"\n",(0,s.jsxs)(n.p,{children:["在",(0,s.jsx)(n.a,{href:"https://www.yuque.com/ruochuan12/notice/p12",rel:"noopener noreferrer",target:"_blank",children:"源码共读第12期"}),"中，我们学习了",(0,s.jsx)(n.a,{href:"https://juejin.cn/post/7023910122770399269",rel:"noopener noreferrer",target:"_blank",children:"尤雨溪推荐神器 ni ，能替代 npm/yarn/pnpm ？简单好用！源码揭秘！"}),"\n根据锁文件自动匹配相应的包管理器，运行相应的命令。"]}),"\n",(0,s.jsxs)(n.p,{children:["在",(0,s.jsx)(n.a,{href:"https://www.yuque.com/ruochuan12/notice/p3",rel:"noopener noreferrer",target:"_blank",children:"源码共读第3期"}),"中，我们学习了",(0,s.jsx)(n.a,{href:"https://juejin.cn/post/6997943192851054606",rel:"noopener noreferrer",target:"_blank",children:"Vue 3.2 发布了，那尤雨溪是怎么发布 Vue.js 的？"})]}),"\n",(0,s.jsxs)(n.p,{children:["其中 Vue3 源码用了 npm 的 ",(0,s.jsx)(n.code,{children:"preinstall"})," ",(0,s.jsx)(n.a,{href:"https://docs.npmjs.com/cli/v6/using-npm/scripts#pre--post-scripts",rel:"noopener noreferrer",target:"_blank",children:"钩子"})," 约束，只能使用 ",(0,s.jsx)(n.code,{children:"pnpm"})," 安装依赖。我们接着来看其实现。"]}),"\n",(0,s.jsxs)(n.h2,{id:"3-vue3-源码--npm-命令钩子",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#3-vue3-源码--npm-命令钩子",children:"#"}),"3. Vue3 源码 && npm 命令钩子"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'// vue-next/package.json\n{\n  "private": true,\n  "version": "3.2.22",\n  "scripts": {\n    "preinstall": "node ./scripts/preinstall.js",\n  }\n}\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"依次执行\n# install 之前执行这个脚本\npreinstall\n# 执行 install 脚本\ninstall\n# install 之后执行这个脚本\npostinstall\n"})}),"\n",(0,s.jsx)(n.p,{children:"当然也支持自定义的命令。"}),"\n",(0,s.jsxs)(n.p,{children:["更多可以查看官方文档",(0,s.jsx)(n.a,{href:"https://docs.npmjs.com/cli/v6/using-npm/scripts#pre--post-scripts",rel:"noopener noreferrer",target:"_blank",children:"钩子"}),"。"]}),"\n",(0,s.jsxs)(n.p,{children:["接着我们来看 ",(0,s.jsx)(n.a,{href:"https://github1s.com/vuejs/vue-next/blob/HEAD/scripts/preinstall.js#L1-L8",rel:"noopener noreferrer",target:"_blank",children:"preinstall"})," 源码。"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// vue-next/scripts/preinstall.js\n\nif (!/pnpm/.test(process.env.npm_execpath || '')) {\n  console.warn(\n    `\\u001b[33mThis repository requires using pnpm as the package manager ` +\n      ` for scripts to work properly.\\u001b[39m\\n`\n  )\n  process.exit(1)\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["这段代码也相对简单，校验如果不是 ",(0,s.jsx)(n.code,{children:"pnpm"})," 执行脚本则报错，退出进程。"]}),"\n",(0,s.jsxs)(n.p,{children:["关于 ",(0,s.jsx)(n.code,{children:"process"})," 对象可以查看 ",(0,s.jsx)(n.a,{href:"http://javascript.ruanyifeng.com/nodejs/process.html",rel:"noopener noreferrer",target:"_blank",children:"阮一峰老师 process 对象"})]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"process.argv"})," 属性返回一个数组，由命令行执行脚本时的各个参数组成。它的第一个成员总是 ",(0,s.jsx)(n.code,{children:"node"}),"，第二个成员是脚本文件名，其余成员是脚本文件的参数。"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["这段代码能解决文章开头场景提出的问题，但是总不能每个项目都复制粘贴这段代码吧。我们是不是可以封装成 npm 包使用。\n当时我也没想太多，也没有封装 npm 包。直到我翻看 ",(0,s.jsx)(n.a,{href:"https://github.com/vitejs/vite/blob/main/package.json#L12",rel:"noopener noreferrer",target:"_blank",children:"vite"})," 源码发现了 ",(0,s.jsx)(n.a,{href:"https://github.com/pnpm/only-allow",rel:"noopener noreferrer",target:"_blank",children:"only-allow"})," 这个包。",(0,s.jsx)(n.strong,{children:"一行代码统一规范包管理器"}),"。"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'{\n  "scripts": {\n    "preinstall": "npx only-allow pnpm -y"\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["当时看到这段代码时，我就在想：他们咋知道这个的。\n当时依旧也没想太多。",(0,s.jsxs)(n.strong,{children:["直到有一天，发现 pnpm 文档 ",(0,s.jsx)(n.a,{href:"https://pnpm.io/only-allow-pnpm",rel:"noopener noreferrer",target:"_blank",children:"Only allow pnpm 文档"})," 上就有这个。好吧，吃了没看文档的亏"]}),"。那时我打算分析下这个",(0,s.jsx)(n.a,{href:"https://github1s.com/pnpm/only-allow/blob/master/bin.js",rel:"noopener noreferrer",target:"_blank",children:"only-allow 包的源码"}),"，打开一看惊喜万分，才 36 行，写它，于是写了这篇文章。"]}),"\n",(0,s.jsx)(n.p,{children:"按照惯例，看源码前先准备环境。"}),"\n",(0,s.jsxs)(n.h2,{id:"4-环境准备",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#4-环境准备",children:"#"}),"4. 环境准备"]}),"\n",(0,s.jsx)(n.p,{children:"先克隆代码。"}),"\n",(0,s.jsxs)(n.h3,{id:"41-克隆代码",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#41-克隆代码",children:"#"}),"4.1 克隆代码"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# 推荐克隆我的源码库\ngit clone https://github.com/ruochuan12/only-allow-analysis.git\ncd only-allow-analysis/only-allow\n# npm i -g pnpm\npnpm i\n\n# 或者克隆官方仓库\ngit clone https://github.com/pnpm/only-allow.git\ncd only-allow\n# npm i -g pnpm\npnpm i\n"})}),"\n",(0,s.jsxs)(n.p,{children:["开源项目一般先看",(0,s.jsx)(n.a,{href:"https://github.com/pnpm/only-allow",rel:"noopener noreferrer",target:"_blank",children:"README.md"}),"。"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Force a specific package manager to be used on a project"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"强制在项目上使用特定的包管理器"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Usage"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Add a preinstall script to your project's package.json."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["If you want to force ",(0,s.jsx)(n.a,{href:"https://yarnpkg.com/",rel:"noopener noreferrer",target:"_blank",children:"yarn"}),", add:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'{\n  "scripts": {\n    "preinstall": "npx only-allow yarn"\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["同理可得：强制使用 ",(0,s.jsx)(n.code,{children:"npm"}),"、",(0,s.jsx)(n.code,{children:"pnpm"}),"也是类似设置。"]}),"\n",(0,s.jsxs)(n.h3,{id:"42-调试源码",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#42-调试源码",children:"#"}),"4.2 调试源码"]}),"\n",(0,s.jsxs)(n.p,{children:["我们通过查看 ",(0,s.jsx)(n.code,{children:"package.json"})," 文件。"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'// only-allow/package.json\n{\n  "bin": "bin.js",\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["确定主入口文件为 ",(0,s.jsx)(n.code,{children:"only-allow/bin.js"}),"。"]}),"\n",(0,s.jsxs)(n.p,{children:["在最新版的 ",(0,s.jsx)(n.code,{children:"VSCode"})," 中，",(0,s.jsx)(n.code,{children:"auto attach"})," 功能，默认支持智能调试，如果发现不支持，可以通过快捷键 ",(0,s.jsx)(n.code,{children:"ctrl + shift + p"})," 查看是否启用。"]}),"\n",(0,s.jsxs)(n.p,{children:["于是我们在 ",(0,s.jsx)(n.code,{children:"only-allow/package.json"})," 文件中，添加如下命令。"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'// only-allow/package.json\n{\n  "scripts": {\n    "preinstall": "node bin.js pnpm"\n  },\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["可以提前在 ",(0,s.jsx)(n.code,{children:"only-allow/bin.js"})," 文件打上断点 ",(0,s.jsx)(n.code,{children:"const usedPM = whichPMRuns()"})]}),"\n",(0,s.jsxs)(n.p,{children:["按快捷键 ctrl + ` 快捷键打开终端。输入如下 ",(0,s.jsx)(n.code,{children:"yarn add release-it -D"})," 命令，即可调试 ",(0,s.jsx)(n.code,{children:"only-allow/bin.js"}),"。"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"调试截图",src:o})}),"\n",(0,s.jsxs)(n.p,{children:["最终调试完会在终端报错提示使用 ",(0,s.jsx)(n.code,{children:"pnpm install"}),"。"]}),"\n",(0,s.jsx)(n.p,{children:"如下图所示："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"终端报错截图",src:t})}),"\n",(0,s.jsxs)(n.p,{children:["更多调试细节可以看我的这篇文章：",(0,s.jsx)(n.a,{href:"https://juejin.cn/post/7030584939020042254",rel:"noopener noreferrer",target:"_blank",children:"新手向：前端程序员必学基本技能——调试JS代码"})]}),"\n",(0,s.jsx)(n.p,{children:"接着我们按调试来看源码主流程。"}),"\n",(0,s.jsxs)(n.h2,{id:"5-only-allow-源码",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#5-only-allow-源码",children:"#"}),"5. only-allow 源码"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// only-allow/bin.js\n#!/usr/bin/env node\nconst whichPMRuns = require('which-pm-runs')\n// 输出边框盒子\nconst boxen = require('boxen')\n\nconst argv = process.argv.slice(2)\nif (argv.length === 0) {\n  console.log('Please specify the wanted package manager: only-allow <npm|pnpm|yarn>')\n  process.exit(1)\n}\n// 第一个参数则是 用户传入的希望使用的包管理器\n// 比如 npx only-allow pnpm\n// 这里调试是 node bin.js pnpm\nconst wantedPM = argv[0]\n// npm pnpm yarn 都不是，则报错\nif (wantedPM !== 'npm' && wantedPM !== 'pnpm' && wantedPM !== 'yarn') {\n  console.log(`\"${wantedPM}\" is not a valid package manager. Available package managers are: npm, pnpm, or yarn.`)\n  process.exit(1)\n}\n// 使用的包管理器\nconst usedPM = whichPMRuns()\n// 希望使用的包管理器 不相等，则报错。\n// - npm  提示使用 npm install\n// - pnpm 提示使用 pnpm install\n// - yarn 提示使用 yarn install\n// 最后退出进程\nif (usedPM && usedPM.name !== wantedPM) {\n  const boxenOpts = { borderColor: 'red', borderStyle: 'double', padding: 1 }\n  switch (wantedPM) {\n    case 'npm':\n      console.log(boxen('Use \"npm install\" for installation in this project', boxenOpts))\n      break\n    case 'pnpm':\n      console.log(boxen(`Use \"pnpm install\" for installation in this project.\n\nIf you don't have pnpm, install it via \"npm i -g pnpm\".\nFor more details, go to https://pnpm.js.org/`, boxenOpts))\n      break\n    case 'yarn':\n      console.log(boxen(`Use \"yarn\" for installation in this project.\n\nIf you don't have Yarn, install it via \"npm i -g yarn\".\nFor more details, go to https://yarnpkg.com/`, boxenOpts))\n      break\n  }\n  process.exit(1)\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["跟着断点，我们可以查看到 ",(0,s.jsx)(n.a,{href:"https://github1s.com/zkochan/packages/blob/master/which-pm-runs/index.js",rel:"noopener noreferrer",target:"_blank",children:"which-pm-runs"}),"。"]}),"\n",(0,s.jsxs)(n.h2,{id:"6-which-pm-runs-当前运行的是哪一个包管理器",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#6-which-pm-runs-当前运行的是哪一个包管理器",children:"#"}),"6. which-pm-runs 当前运行的是哪一个包管理器"]}),"\n",(0,s.jsx)(n.p,{children:"最终返回包管理器和版本号。"}),"\n",(0,s.jsxs)(n.p,{children:["根据调试可知，",(0,s.jsx)(n.code,{children:"process.env.npm_config_user_agent"})," 是类似这样的字符串。"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:'"yarn/1.22.10 npm/? node/v14.16.0 linux x64"'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"'use strict'\n\nmodule.exports = function () {\n  if (!process.env.npm_config_user_agent) {\n    return undefined\n  }\n  return pmFromUserAgent(process.env.npm_config_user_agent)\n}\n\nfunction pmFromUserAgent (userAgent) {\n  const pmSpec = userAgent.split(' ')[0]\n  const separatorPos = pmSpec.lastIndexOf('/')\n  return {\n    name: pmSpec.substr(0, separatorPos),\n    version: pmSpec.substr(separatorPos + 1)\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"61-stringprototypesubstr-截取字符串",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#61-stringprototypesubstr-截取字符串",children:"#"}),"6.1 String.prototype.substr 截取字符串"]}),"\n",(0,s.jsxs)(n.p,{children:["顺带提下。我之前在 vue-next 源码看到的 ",(0,s.jsx)(n.a,{href:"https://github.com/vuejs/vue-next/pull/4699",rel:"noopener noreferrer",target:"_blank",children:"pull request => chore: remove deprecated String.prototype.substr"})]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"String.prototype.substr is deprecated."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["也就是说不推荐使用 ",(0,s.jsx)(n.code,{children:"substr"}),"。推荐使用 ",(0,s.jsx)(n.code,{children:"slice"}),"。"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://262.ecma-international.org/9.0/#sec-additional-ecmascript-features-for-web-browsers",rel:"noopener noreferrer",target:"_blank",children:"ecma 规范"})}),"\n",(0,s.jsxs)(n.h2,{id:"7-总结",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#7-总结",children:"#"}),"7. 总结"]}),"\n",(0,s.jsxs)(n.p,{children:["我们通过从团队需要规范统一包管理器的实际场景出发，讲了 vue3 源码中 preinstall 钩子 约束只能使用 pnpm 。同时通过查看 ",(0,s.jsx)(n.a,{href:"https://github.com/vitejs/vite/blob/main/package.json#L12",rel:"noopener noreferrer",target:"_blank",children:"vite"})," 源码和 ",(0,s.jsx)(n.a,{href:"https://pnpm.io/only-allow-pnpm",rel:"noopener noreferrer",target:"_blank",children:"pnpm"})," 文档，了解到 ",(0,s.jsx)(n.a,{href:"https://github.com/pnpm/only-allow.git",rel:"noopener noreferrer",target:"_blank",children:"only-allow"})," 这个包。可以做到一行代码统一规范包管理器",(0,s.jsx)(n.code,{children:'"preinstall": "npx only-allow pnpm"'}),"。"]}),"\n",(0,s.jsxs)(n.p,{children:["也学习了其原理。only-allow 期待的包管理器和运行的包管理器对比。匹配失败，则报错。而which-pm-runs 通过获取 ",(0,s.jsx)(n.code,{children:"process.env.npm_config_user_agent"})," 变量获取到当前运行脚本的包管理器和版本号。"]}),"\n",(0,s.jsx)(n.p,{children:"我们通过文档和沟通约束，不如用工具（代码）约束。"}),"\n",(0,s.jsxs)(n.p,{children:["文章写到这里，让我想起我2018年写的文章",(0,s.jsx)(n.a,{href:"https://ruochuan12.github.io/20180421-youzan-front-end-tech-open-day/",rel:"noopener noreferrer",target:"_blank",children:"参加有赞前端技术开放日所感所想"})]}),"\n",(0,s.jsx)(n.p,{children:"当时演讲的大佬说过一句话。无比赞同。"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"技术（开源）项目本质上是：理念、套路、规范的工具化。"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"同时给我们的启发也是要多看官方文档和规范。"}),"\n",(0,s.jsxs)(n.p,{children:["建议读者克隆",(0,s.jsx)(n.a,{href:"https://github.com/ruochuan12/only-allow-analysis.git",rel:"noopener noreferrer",target:"_blank",children:"我的仓库"}),"动手实践调试源码学习。"]}),"\n",(0,s.jsxs)(n.p,{children:["最后可以持续关注我@若川。欢迎加我微信 ",(0,s.jsx)(n.a,{href:"https://juejin.cn/pin/7005372623400435725",rel:"noopener noreferrer",target:"_blank",children:"ruochuan12"})," 交流，参与 ",(0,s.jsx)(n.a,{href:"https://juejin.cn/pin/7005372623400435725",rel:"noopener noreferrer",target:"_blank",children:"源码共读"})," 活动，每周大家一起学习200行左右的源码，共同进步。"]})]})}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,l.ah)(),e.components);return n?(0,s.jsx)(n,Object.assign({},e,{children:(0,s.jsx)(i,e)})):i(e)}let p=c;c.__RSPRESS_PAGE_META={},c.__RSPRESS_PAGE_META["only-allow%2Findex.md"]={toc:[{id:"1-前言",text:"1. 前言",depth:2},{id:"2-场景",text:"2. 场景",depth:2},{id:"3-vue3-源码--npm-命令钩子",text:"3. Vue3 源码 && npm 命令钩子",depth:2},{id:"4-环境准备",text:"4. 环境准备",depth:2},{id:"41-克隆代码",text:"4.1 克隆代码",depth:3},{id:"42-调试源码",text:"4.2 调试源码",depth:3},{id:"5-only-allow-源码",text:"5. only-allow 源码",depth:2},{id:"6-which-pm-runs-当前运行的是哪一个包管理器",text:"6. which-pm-runs 当前运行的是哪一个包管理器",depth:2},{id:"61-stringprototypesubstr-截取字符串",text:"6.1 String.prototype.substr 截取字符串",depth:3},{id:"7-总结",text:"7. 总结",depth:2}],title:"从 vue3 和 vite 源码中，我学到了一行代码统一规范团队包管理器的神器",headingTitle:"从 vue3 和 vite 源码中，我学到了一行代码统一规范团队包管理器的神器",frontmatter:{highlight:"darcula",theme:"smartblue"}}},20713:function(e,n,r){r.d(n,{Z:()=>i});var s=r(52676),l=r(75271),a=r(92815);r(18544);let o={"zh-CN":e=>`\u{9884}\u{8BA1}\u{9605}\u{8BFB}\u{65F6}\u{95F4}: ${e.minutes>=1?`${Math.ceil(e.minutes)} \u{5206}\u{949F}`:"小于 1 分钟"}`,"en-US":e=>`Estimated reading time: ${e.minutes>=1?`${Math.ceil(e.minutes)} minutes`:"less than 1 minute"}`};function t(e,n,r){let s=Object.keys(o).includes(n)?n:r;return o[s](e)}let i=e=>{let{defaultLocale:n="en-US"}=e,r=(0,a.Vi)().page.readingTimeData,o=(0,a.Jr)(),i=(0,a.e7)(),[c,p]=(0,l.useState)(t(r,o,n));return(0,l.useEffect)(()=>{p(t(r,o,n))},[o,r]),(0,s.jsx)("span",{"data-dark":String(i),className:"rp-reading-time",children:c})}}}]);