"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([["1421"],{1356:function(e,n,r){r.r(n),r.d(n,{default:()=>g});var t=r(52676),i=r(40453),s=r(20713);let o=r.p+"static/image/vscode-open-in-github.2655f473.png",a=r.p+"static/image/ext-setting.1719d1c6.png",c=r.p+"static/image/opening-the-project.2f065a67.gif",h=r.p+"static/image/opening-the-file.b3fa117a.gif",l=r.p+"static/image/debuger-launcher-auto.31db1036.gif",d=r.p+"static/image/debugger-launcher-auto-gif.30d4dc8b.gif";function p(e){let n=Object.assign({h1:"h1",a:"a",h2:"h2",p:"p",code:"code",img:"img",pre:"pre",h3:"h3",ul:"ul",li:"li",h4:"h4",blockquote:"blockquote",strong:"strong",hr:"hr"},(0,i.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.h1,{id:"神器啊从未想过-vscode-还能这样直接打开仓库url原理揭秘",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#神器啊从未想过-vscode-还能这样直接打开仓库url原理揭秘",children:"#"}),"神器啊，从未想过 VSCode 还能这样直接打开仓库URL，原理揭秘~"]}),"\n",(0,t.jsx)(s.Z,{defaultLocale:"zh-CN"}),"\n",(0,t.jsxs)(n.h2,{id:"1-前言",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1-前言",children:"#"}),"1. 前言"]}),"\n",(0,t.jsxs)(n.p,{children:["大家好，我是",(0,t.jsx)(n.a,{href:"https://ruochuan12.github.io",rel:"noopener noreferrer",target:"_blank",children:"若川"}),"，欢迎 ",(0,t.jsx)(n.code,{children:"follow"})," ",(0,t.jsx)(n.a,{href:"https://github.com/ruochuan12",rel:"noopener noreferrer",target:"_blank",children:"我的 github"}),"。我倾力持续组织了一年多",(0,t.jsx)(n.a,{href:"https://juejin.cn/post/7079706017579139102",rel:"noopener noreferrer",target:"_blank",children:"每周大家一起学习200行左右的源码共读活动"}),"，感兴趣的可以",(0,t.jsxs)(n.a,{href:"https://juejin.cn/pin/7217386885793595453",rel:"noopener noreferrer",target:"_blank",children:["点此扫码加我微信 ",(0,t.jsx)(n.code,{children:"ruochuan02"})," 参与"]}),"。另外，想学源码，极力推荐关注我写的专栏",(0,t.jsx)(n.a,{href:"https://juejin.cn/column/6960551178908205093",rel:"noopener noreferrer",target:"_blank",children:"《学习源码整体架构系列》"}),"，目前是掘金关注人数（4.7k+人）第一的专栏，写有20余篇源码文章。"]}),"\n",(0,t.jsxs)(n.p,{children:["最近 ",(0,t.jsx)(n.a,{href:"https://github.com/antfu",rel:"noopener noreferrer",target:"_blank",children:(0,t.jsx)(n.code,{children:"antfu"})})," 在 ",(0,t.jsx)(n.code,{children:"Twitter"})," 上发推开发了一个 ",(0,t.jsx)(n.a,{href:"https://github.com/antfu/vscode-open-in-github-button",rel:"noopener noreferrer",target:"_blank",children:(0,t.jsx)(n.code,{children:"VSCode"})})," 插件。"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"vscode-open-in-github",src:o})}),"\n",(0,t.jsxs)(n.p,{children:["你应该有碰到这样的场景。自己公司项目 ",(0,t.jsx)(n.code,{children:"gitlab"})," 或者 ",(0,t.jsx)(n.code,{children:"github"})," 项目。想快速打开网页去做一些操作，但耗时很久。那么有了这个插件后就方便快速很多，直接在状态栏点击一下图标即可打开。"]}),"\n",(0,t.jsxs)(n.p,{children:["安装插件 ",(0,t.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=antfu.open-in-github-button",rel:"noopener noreferrer",target:"_blank",children:"open in github button"}),"，",(0,t.jsx)(n.a,{href:"https://github.com/antfu/vscode-open-in-github-button",rel:"noopener noreferrer",target:"_blank",children:"github repo"})," 后，会安装上依赖的另外一个插件 ",(0,t.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=fabiospampinato.vscode-open-in-github",rel:"noopener noreferrer",target:"_blank",children:"Open in GitHub"}),"，",(0,t.jsx)(n.a,{href:"https://github.com/fabiospampinato/vscode-open-in-github",rel:"noopener noreferrer",target:"_blank",children:"github repo"}),"。"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"Open in GitHub"})," 插件也提供了一些用户自定义配置。支持配置为自己的域名，比如 ",(0,t.jsx)(n.code,{children:"gitlab"}),"，配置好后就能打开相应的项目地址。"]}),"\n",(0,t.jsxs)(n.p,{children:["可以全局设置 ",(0,t.jsx)(n.code,{children:"@ext:fabiospampinato.vscode-open-in-github"}),"。如下图所示："]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.img,{alt:"扩展设置",src:a}),"。"]}),"\n",(0,t.jsxs)(n.p,{children:["也可以在项目中新增 ",(0,t.jsx)(n.code,{children:".vscode/setting.json"})," 配置。"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'// setting.json\n{\n  "openInGitHub.github.domain": "github.com", // Custom GitHub domain\n  "openInGitHub.remote.name": "origin", // Name of the remote repository\n  "openInGitHub.remote.branch": "master", // Name of the remote branch\n  "openInGitHub.useLocalBranch": true, // Use the local branch instead of the fixed remote branch\n  "openInGitHub.useLocalRange": true, // Highlight the local selection range, if there\'s one\n  "openInGitHub.useLocalLine": false // Highlight the local line if there\'s no selection range\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["除了包含打开项目的命令，还包含了其他很多命令，比如打开 ",(0,t.jsx)(n.code,{children:"issue、action、pull request、release 等"}),"，可以按快捷键：",(0,t.jsx)(n.code,{children:"ctrl + shift + p"})," 输入 ",(0,t.jsx)(n.code,{children:">open in github"})," 查看。"]}),"\n",(0,t.jsx)(n.p,{children:"本文主要来讲述它们的实现原理。"}),"\n",(0,t.jsx)(n.p,{children:"学完本文，你将学到："}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"1. 如何开发一个 VSCode 插件\n2. 学会开发开源项目的工作流是怎样的\n3. 学会调试 VSCode 插件\n4. 学会 open in github button vscode 插件的原理是什么\n5. 学会 open in github vscode 插件原理\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"2-环境准备",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2-环境准备",children:"#"}),"2. 环境准备"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# 克隆我的项目\ngit clone https://github.com/ruochuan12/vscode-open-in-github-button-analysis.git\n# npm i -g pnpm\ncd vscode-open-in-github-button-analysis/vscode-open-in-github-button\npnpm install\n# vscode-open-in-github 项目\ncd vscode-open-in-github-button-analysis/vscode-open-in-github\npnpm install\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://github.com/ruochuan12/vscode-open-in-github-button-analysis.git",rel:"noopener noreferrer",target:"_blank",children:"也可以 star 我的项目"})}),"\n",(0,t.jsxs)(n.h2,{id:"3-vscode-open-in-github-button-项目",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#3-vscode-open-in-github-button-项目",children:"#"}),"3. vscode-open-in-github-button 项目"]}),"\n",(0,t.jsxs)(n.h3,{id:"31-packagejson-scripts-命令解析",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#31-packagejson-scripts-命令解析",children:"#"}),"3.1 package.json scripts 命令解析"]}),"\n",(0,t.jsx)(n.p,{children:"主要依赖依赖如下："}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/antfu/eslint-config",rel:"noopener noreferrer",target:"_blank",children:"eslint 配置 @antfu/eslint-config"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/antfu/ni",rel:"noopener noreferrer",target:"_blank",children:"使用正确的包 @antfu/ni"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/antfu/bumpp",rel:"noopener noreferrer",target:"_blank",children:"提升版本发布相关 bumpp"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/esbuild-kit/esno",rel:"noopener noreferrer",target:"_blank",children:"执行node ts 相关 esno"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/pnpm/pnpm",rel:"noopener noreferrer",target:"_blank",children:"pnpm"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/vitejs/vite",rel:"noopener noreferrer",target:"_blank",children:"vite"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/vitest-dev/vitest#readme",rel:"noopener noreferrer",target:"_blank",children:"vitest"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/microsoft/vscode-vsce",rel:"noopener noreferrer",target:"_blank",children:"vscode 插件发布相关 vsce"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/egoist/tsup",rel:"noopener noreferrer",target:"_blank",children:"tsup ts 打包构建相关"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"scripts"})," 分析"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n    "scripts": {\n        // 用 tsup 打包 vscode 插件扩展\n        "build": "tsup src/index.ts --external vscode",\n        // 开发\n        "dev": "nr build --watch",\n        "lint": "eslint .",\n        // 预发布\n        "vscode:prepublish": "nr build",\n        // 发布，不包含依赖\n        "publish": "vsce publish --no-dependencies",\n        // 打包，不包含依赖\n        "pack": "vsce package --no-dependencies",\n        // 测试\n        "test": "vitest",\n        // type 检测\n        "typecheck": "tsc --noEmit",\n        // 发布\n        "release": "bumpp && nr publish"\n    }\n}\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"32-github-actions",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#32-github-actions",children:"#"}),"3.2 github actions"]}),"\n",(0,t.jsxs)(n.p,{children:["看项目前，我们先来看下 ",(0,t.jsx)(n.code,{children:"github actions"})," 配置。\n",(0,t.jsx)(n.a,{href:"https://docs.github.com/zh/actions/learn-github-actions/understanding-github-actions",rel:"noopener noreferrer",target:"_blank",children:"了解 GitHub Actions"})]}),"\n",(0,t.jsx)(n.p,{children:"一个开源项目，一般会有基础的 workflow。"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"ci 每次 git push 命令时自动执行 lint 和 test 等，保证校验通过。"}),"\n",(0,t.jsx)(n.li,{children:"release：每次检测到 git tag，就自动发一个包。"}),"\n"]}),"\n",(0,t.jsxs)(n.h4,{id:"321-ci",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#321-ci",children:"#"}),"3.2.1 ci"]}),"\n",(0,t.jsxs)(n.p,{children:["安装 pnpm ，使用 node 16.x，全局安装 ni 工具，执行 nci npm ci npm run lint\n有三个job：",(0,t.jsx)(n.code,{children:"lint"}),"、",(0,t.jsx)(n.code,{children:"typecheck"}),"、",(0,t.jsx)(n.code,{children:"test"}),"。"]}),"\n",(0,t.jsxs)(n.p,{children:["这块代码由于太长，有删减，",(0,t.jsx)(n.a,{href:"https://github.com/antfu/vscode-open-in-github-button/blob/main/.github/workflows/ci.yml",rel:"noopener noreferrer",target:"_blank",children:"可点此查看完整代码"}),"。"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yml",children:"# vscode-open-in-github-button/.github/workflows/ci.yml\nname: CI\n# main 分支 push 和 pr 会触发\non:\n  push:\n    branches:\n      - main\n  pull_request:\n    branches:\n      - main\njobs:\n  lint:\n    runs-on: ubuntu-latest\n  typecheck:\n    runs-on: ubuntu-latest\n  test:\n    runs-on: ${{ matrix.os }}\n"})}),"\n",(0,t.jsxs)(n.h4,{id:"322-release-发布",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#322-release-发布",children:"#"}),"3.2.2 release 发布"]}),"\n",(0,t.jsxs)(n.p,{children:["git push tag 时触发，用 ",(0,t.jsx)(n.a,{href:"https://github.com/antfu/changelogithub",rel:"noopener noreferrer",target:"_blank",children:"changelogithub"})," 生成 ",(0,t.jsx)(n.code,{children:"changelog"}),"。"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://docs.github.com/zh/actions/security-guides/automatic-token-authentication",rel:"noopener noreferrer",target:"_blank",children:"其中自动令牌身份验证 secrets.GITHUB_TOKEN"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yml",children:"# vscode-open-in-github-button/.github/workflows/release.yml\nname: Release\n# 赋予 secrets.GITHUB_TOKEN 写内容的权限\npermissions:\n  contents: write\non:\n  push:\n    tags:\n      - 'v*'\njobs:\n  release:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n        with:\n          fetch-depth: 0\n      - uses: actions/setup-node@v3\n        with:\n          node-version: 16.x\n      - run: npx changelogithub\n        env:\n          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["我们来简单看下测试用例。这个项目用 ",(0,t.jsx)(n.a,{href:"https://cn.vitest.dev/",rel:"noopener noreferrer",target:"_blank",children:"vitest"})," 测试。写了一个假的测试用例，因为在这个项目中没什么好测试的。"]}),"\n",(0,t.jsxs)(n.h4,{id:"323-vitest-测试",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#323-vitest-测试",children:"#"}),"3.2.3 vitest 测试"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// test/index.test.ts\nimport { describe, expect, it } from 'vitest'\n\ndescribe('should', () => {\n  it('exported', () => {\n    expect(1).toEqual(1)\n  })\n})\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"33-入口文件-indexts",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#33-入口文件-indexts",children:"#"}),"3.3 入口文件 index.ts"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"import { StatusBarAlignment, window } from 'vscode'\n\nexport function activate() {\n  const statusBar = window.createStatusBarItem(StatusBarAlignment.Left, 0)\n  statusBar.command = 'openInGitHub.openProject'\n  statusBar.text = '$(github)'\n  statusBar.tooltip = 'Open in GitHub'\n  statusBar.show()\n}\n\nexport function deactivate() {\n\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["点击状态栏的 ",(0,t.jsx)(n.code,{children:"open in github"})," 按钮，其实执行的是 ",(0,t.jsx)(n.code,{children:"'openInGitHub.openProject'"})," 命令。"]}),"\n",(0,t.jsxs)(n.h3,{id:"34-openingithubopenproject",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#34-openingithubopenproject",children:"#"}),"3.4 openInGitHub.openProject"]}),"\n",(0,t.jsxs)(n.p,{children:["这时放几个官方链接。\n",(0,t.jsx)(n.a,{href:"https://marketplace.visualstudio.com/VSCode",rel:"noopener noreferrer",target:"_blank",children:"VSCode 插件市场"}),"\n",(0,t.jsx)(n.a,{href:"https://code.visualstudio.com/api",rel:"noopener noreferrer",target:"_blank",children:"vscode api"}),"\n如果看英文文档吃力，这里推荐 ",(0,t.jsx)(n.code,{children:"Edge"})," 浏览器可以翻译成中文，或者谷歌自带的翻译，或者其他翻译插件。"]}),"\n",(0,t.jsxs)(n.p,{children:["翻看文档和 项目",(0,t.jsx)(n.code,{children:"package.json"})," 文件，我们可以得知，这个命令并不是官方提供的，而是依赖第三方的扩展插件。"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "extensionPack": [\n    "fabiospampinato.vscode-open-in-github"\n  ],\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["我们来看这个插件，",(0,t.jsx)(n.a,{href:"https://github.com/fabiospampinato/vscode-open-in-github.git",rel:"noopener noreferrer",target:"_blank",children:"vscode-open-in-github"}),"。"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["open in project\n",(0,t.jsx)(n.img,{alt:"打开项目 github",src:c})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"打开项目 github",src:h})}),"\n",(0,t.jsxs)(n.p,{children:["贡献文档\n",(0,t.jsx)(n.strong,{children:"Contributing"})]}),"\n",(0,t.jsxs)(n.p,{children:["If you found a problem, or have a feature request, please open an ",(0,t.jsx)(n.a,{href:"https://github.com/fabiospampinato/vscode-open-in-github/issues",rel:"noopener noreferrer",target:"_blank",children:"issue"})," about it."]}),"\n",(0,t.jsxs)(n.p,{children:["If you want to make a pull request you can debug the extension using ",(0,t.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=fabiospampinato.vscode-debug-launcher",rel:"noopener noreferrer",target:"_blank",children:"Debug Launcher"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["调试安装作者推荐的调试工具 ",(0,t.jsx)(n.code,{children:"Debug Launcher"}),"。"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Debug Launcher auto 调试",src:l})}),"\n",(0,t.jsxs)(n.p,{children:["我们找到 ",(0,t.jsx)(n.code,{children:"main"})," 入口文件。"]}),"\n",(0,t.jsxs)(n.h2,{id:"4-vscode-open-in-github-packagejson",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#4-vscode-open-in-github-packagejson",children:"#"}),"4. vscode-open-in-github package.json"]}),"\n",(0,t.jsx)(n.p,{children:"入口文件"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "main": "out/extension.js",\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"主要依赖如下："}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/lodash/lodash",rel:"noopener noreferrer",target:"_blank",children:"lodash"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/sindresorhus/pify#readme",rel:"noopener noreferrer",target:"_blank",children:"回调函数转 Promise pify"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/steveukx/git-js#readme",rel:"noopener noreferrer",target:"_blank",children:"simple-git"})}),"\n"]}),"\n",(0,t.jsxs)(n.h2,{id:"5-调试项目",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#5-调试项目",children:"#"}),"5. 调试项目"]}),"\n",(0,t.jsx)(n.p,{children:"克隆项目，然后安装依赖"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/fabiospampinato/vscode-open-in-github.git\ncd vscode-open-in-github\n\nnpm install\n# 或者\n# npm i -g yarn\nyarn install\n# 或者\n# npm i -g pnpm\npnpm install\n"})}),"\n",(0,t.jsxs)(n.p,{children:["选中 ",(0,t.jsx)(n.code,{children:"package.json"})," 中的，",(0,t.jsx)(n.code,{children:'"main": "out/extension.js"'}),"，按 ",(0,t.jsx)(n.code,{children:"ctrl + shift + p"}),"。输入选择 ",(0,t.jsx)(n.code,{children:"debug launcher auto"})," 即可调试。"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"调试截图",src:d})}),"\n",(0,t.jsxs)(n.h2,{id:"6-入口-srcextensionts",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#6-入口-srcextensionts",children:"#"}),"6. 入口 src/extension.ts"]}),"\n",(0,t.jsxs)(n.p,{children:["我们可以从 ",(0,t.jsx)(n.code,{children:"webpack.config.js"})," 配置看到入口文件 ",(0,t.jsx)(n.code,{children:"src/extension.ts"}),"，可以提前去打好断点等。"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// vscode-open-in-github/webpack.config.js\nconst config = {\n  target: 'node',\n  entry: './src/extension.ts',\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// vscode-open-in-github/src/extension.ts\n/* IMPORT */\nimport Utils from './utils';\n/* ACTIVATE */\nconst activate = Utils.initCommands;\n/* EXPORT */\nexport {activate};\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"61-utils-工具函数",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#61-utils-工具函数",children:"#"}),"6.1 Utils 工具函数"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"/* IMPORT */\nimport * as _ from 'lodash';\nimport * as absolute from 'absolute';\nimport * as findUp from 'find-up';\nimport * as path from 'path';\nimport * as pify from 'pify';\nimport * as simpleGit from 'simple-git';\nimport * as vscode from 'vscode';\nimport * as Commands from './commands';\nimport Config from './config';\n\n/* UTILS */\nconst Utils = {\n  // 初始化命令\n  initCommands ( context: vscode.ExtensionContext ) {\n    /**\n     *\n     * contributes: {\n     * \"commands\": [\n      {\n        \"command\": \"openInGitHub.openProject\",\n        \"title\": \"Open in GitHub: Project\"\n      },\n     * }\n     *\n    */\n    const {commands} = vscode.extensions.getExtension ( 'fabiospampinato.vscode-open-in-github' ).packageJSON.contributes;\n    commands.forEach ( ({ command, title }) => {\n      const commandName = _.last ( command.split ( '.' ) ) as string,\n            // openProject\n            handler = Commands[commandName],\n            // 注册 openProject 命令，函数是 Commands[openProject]\n            disposable = vscode.commands.registerCommand ( command, () => handler () );\n      context.subscriptions.push ( disposable );\n    });\n    return Commands;\n  },\n}\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"62-commands-导出的命令函数",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#62-commands-导出的命令函数",children:"#"}),"6.2 Commands 导出的命令函数"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// vscode-open-in-github/src/commands.ts\n/* IMPORT */\nimport URL from './url';\n/* COMMANDS */\nfunction openProject () {\n  return URL.open ();\n}\n// 省略了若干其他命令\nexport { openProject };\n"})}),"\n",(0,t.jsxs)(n.p,{children:["导出的函数，我们可以看出是调用的 ",(0,t.jsx)(n.code,{children:"URL.open"})," 函数。\n我们可以接着看 ",(0,t.jsx)(n.code,{children:"URL"})," 对象。"]}),"\n",(0,t.jsxs)(n.h3,{id:"63-url-对象",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#63-url-对象",children:"#"}),"6.3 URL 对象"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// vscode-open-in-github/src/url.ts\n/* IMPORT */\nimport * as _ from 'lodash';\nimport * as vscode from 'vscode';\nimport Config from './config';\nimport Utils from './utils';\n\n/* URL */\nconst URL = {\n  // 省略 get copy 函数\n  async get ( file = false, permalink = false, page? ) {},\n  async copy ( file = false, permalink = false, page? ) {},\n  // 调用的函数\n  async open ( file = false, permalink = false, page? ) {\n    const url = await URL.get ( file, permalink, page );\n    vscode.env.openExternal ( vscode.Uri.parse ( url ) );\n  }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["之前如果我们在 ",(0,t.jsx)(n.code,{children:"URL.get"})," 这里断点。\n我们可以跟着断点调试，来看 ",(0,t.jsx)(n.code,{children:"URL.get"})," 函数。"]}),"\n",(0,t.jsxs)(n.h4,{id:"631-urlget-函数",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#631-urlget-函数",children:"#"}),"6.3.1 URL.get 函数"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const URL = {\n  async get ( file = false, permalink = false, page? ) {\n    // 获取仓库路径\n    const repopath = await Utils.repo.getPath ();\n    if ( !repopath ) return vscode.window.showErrorMessage ( 'You have to open a git project before being able to open it in GitHub' );\n\n    // 根据仓库路径获取 git 实例\n    const git = Utils.repo.getGit ( repopath ),\n    // 用 git 获取 url\n          repourl = await Utils.repo.getUrl ( git );\n          // 没有找到仓库地址，报错\n    if ( !repourl ) return vscode.window.showErrorMessage ( 'Remote repository not found' );\n    // 获取用户配置或者默认配置\n    /***\n     * import * as vscode from 'vscode';\n        const Config = {\n          get ( extension = 'openInGitHub' ) {\n            return vscode.workspace.getConfiguration ().get ( extension ) as any;\n          }\n        };\n     * export default Config;\n     * */\n    const config = Config.get ();\n    let filePath = '',\n        branch = '',\n        lines = '',\n        hash = '';\n\n    // 省略 file 的逻辑\n    branch = encodeURIComponent ( branch );\n    filePath = encodeURIComponent ( filePath ).replace ( /%2F/g, '/' );\n    // 拼接 url\n    const url = _.compact ([ repourl, page, branch, hash, filePath, lines ]).join ( '/' );\n    return url;\n  },\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["我们来重点看下 ",(0,t.jsx)(n.code,{children:"Utils.repo"})," 对象导出的函数。"]}),"\n",(0,t.jsxs)(n.h3,{id:"64-utilsrepo-对象",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#64-utilsrepo-对象",children:"#"}),"6.4 Utils.repo 对象"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"/* IMPORT */\nimport * as _ from 'lodash';\nimport * as absolute from 'absolute';\nimport * as findUp from 'find-up';\nimport * as path from 'path';\nimport * as pify from 'pify';\nimport * as simpleGit from 'simple-git';\nimport * as vscode from 'vscode';\nimport * as Commands from './commands';\nimport Config from './config';\n\nconst Utils = {\n  repo: {\n    // 用 simpleGif 仓库获取 git\n    getGit ( repopath ) {\n      return pify ( _.bindAll ( simpleGit ( repopath ), ['branch', 'getRemotes'] ) );\n    },\n    // 获取 hash\n    async getHash ( git ) {\n      return ( await git.revparse ([ 'HEAD' ]) ).trim ();\n    },\n    // 通过目前路径，获取根路径\n    async getPath () {\n      const {activeTextEditor} = vscode.window,\n            editorPath = activeTextEditor && activeTextEditor.document.uri.fsPath,\n            rootPath = Utils.folder.getRootPath ( editorPath );\n      if ( !rootPath ) return false;\n      // 获取路径\n      return await Utils.folder.getWrapperPathOf ( rootPath, editorPath || rootPath, '.git' );\n    },\n}\n"})}),"\n",(0,t.jsxs)(n.h4,{id:"641-utilsrepogeturl-获取-url",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#641-utilsrepogeturl-获取-url",children:"#"}),"6.4.1 Utils.repo.getUrl 获取 Url"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const Utils = {\n  repo: {\n    async getUrl ( git ) {\n      // 获取配置信息\n      const config = Config.get (),\n      // 远程信息\n            remotes = await git.getRemotes ( true ),\n            remotesGithub = remotes.filter ( remote => ( remote.refs.fetch || remote.refs.push ).includes ( config.github.domain ) ),\n            remoteOrigin = remotesGithub.filter ( remote => remote.name === config.remote.name )[0],\n            remote = remoteOrigin || remotesGithub[0];\n      if ( !remote ) return;\n      const ref = remote.refs.fetch || remote.refs.push,\n            re = /\\.[^.:/]+[:/]([^/]+)\\/(.*?)(?:\\.git|\\/)?$/,\n            match = re.exec ( ref );\n      if ( !match ) return;\n      return `https://${config.github.domain}/${match[1]}/${match[2]}`;\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"总结一下大致流程："}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"vscode"})," 使用 ",(0,t.jsx)(n.code,{children:"vscode.commands.registerCommand ( command, () => handler () )"})," 注册 ",(0,t.jsx)(n.code,{children:"openProject"})," 命令"]}),"\n",(0,t.jsx)(n.li,{children:"ctrl + shift + p 输入 >open in github，选择触发 openInGithub.openProject 命令"}),"\n",(0,t.jsx)(n.li,{children:"执行 openProject 函数，实际调用 URL.open() 函数"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"async open ( file = false, permalink = false, page? ) {\n    const url = await URL.get ( file, permalink, page );\n    vscode.env.openExternal ( vscode.Uri.parse ( url ) );\n  }\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["实际调用的是 ",(0,t.jsx)(n.code,{children:"URL.get"})," 函数","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"先根据 vscode 的能力，获取到仓库的路径"}),"\n",(0,t.jsx)(n.li,{children:"再根据仓库的路径，获取 git 实例（simple-git）"}),"\n",(0,t.jsx)(n.li,{children:"根据 git 实例，获取到仓库的 url"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"最后打开仓库 url 链接。"}),"\n"]}),"\n",(0,t.jsxs)(n.h2,{id:"7-总结",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#7-总结",children:"#"}),"7. 总结"]}),"\n",(0,t.jsx)(n.p,{children:"行文至此，最后，我们来总结下："}),"\n",(0,t.jsxs)(n.p,{children:["通过学习一个状态栏 ",(0,t.jsx)(n.code,{children:"github"})," 图标，即可在浏览器中打开仓库的 ",(0,t.jsx)(n.code,{children:"github"})," 地址功能。\n",(0,t.jsx)(n.a,{href:"https://github.com/antfu/vscode-open-in-github-button",rel:"noopener noreferrer",target:"_blank",children:"open in github button"})," vscode 插件的原理，是调用了 ",(0,t.jsx)(n.a,{href:"https://github.com/fabiospampinato/vscode-open-in-github.git",rel:"noopener noreferrer",target:"_blank",children:"vscode-open-in-github"})," 插件提供的 ",(0,t.jsx)(n.code,{children:"openInGithub.openProject"})," 命令。"]}),"\n",(0,t.jsxs)(n.p,{children:["而 ",(0,t.jsx)(n.code,{children:"openInGithub.openProject"})," 命令是 ",(0,t.jsx)(n.code,{children:"VSCode"})," 插件注册的和执行 ",(0,t.jsx)(n.code,{children:"node"})," 脚本，使用 ",(0,t.jsx)(n.code,{children:"simple-git"})," 获取仓库 ",(0,t.jsx)(n.code,{children:"url"})," 等。最终 ",(0,t.jsx)(n.code,{children:"VSCode"})," 打开浏览器访问这个链接地址。"]}),"\n",(0,t.jsx)(n.p,{children:"这种场景确实存在，但我们不一定会思考到用技术方案解决它。"}),"\n",(0,t.jsxs)(n.p,{children:["打开 ",(0,t.jsx)(n.code,{children:"github"})," 仓库或者 ",(0,t.jsx)(n.code,{children:"gitlab"})," 仓库的方式有挺多。比如终端工具 ",(0,t.jsx)(n.code,{children:"gh browse"}),"。或者在 ",(0,t.jsx)(n.code,{children:"package.json"})," 配置仓库链接地址，再转到找到链接地址去打开。或者找到 ",(0,t.jsx)(n.code,{children:".git/config"})," 中的配置 ",(0,t.jsx)(n.code,{children:"git"})," 链接打开。"]}),"\n",(0,t.jsxs)(n.p,{children:["我们学会了如何利用 ",(0,t.jsx)(n.a,{href:"https://docs.github.com/zh/actions/learn-github-actions/understanding-github-actions",rel:"noopener noreferrer",target:"_blank",children:"GitHub Actions"}),"，用 ",(0,t.jsx)(n.a,{href:"https://github.com/egoist/tsup",rel:"noopener noreferrer",target:"_blank",children:"tsup"})," 构建 ",(0,t.jsx)(n.code,{children:"ts"}),"，用 ",(0,t.jsx)(n.a,{href:"https://github.com/antfu/bumpp",rel:"noopener noreferrer",target:"_blank",children:"bumpp"})," 提升版本号等，用 ",(0,t.jsx)(n.a,{href:"https://github.com/antfu/changelogithub",rel:"noopener noreferrer",target:"_blank",children:"changelogithub"})," 生成 ",(0,t.jsx)(n.code,{children:"changelog"})," 等等，开发一个开源项目。"]}),"\n",(0,t.jsxs)(n.p,{children:["我们还学会了用 ",(0,t.jsx)(n.a,{href:"https://github.com/microsoft/vscode-vsce",rel:"noopener noreferrer",target:"_blank",children:"vsce"})," 如何打包、发布一个 ",(0,t.jsx)(n.code,{children:"VSCode"})," 插件。学会了使用调试工具 ",(0,t.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=fabiospampinato.vscode-debug-launcher",rel:"noopener noreferrer",target:"_blank",children:"Debug Launcher"})," 自动化调试 ",(0,t.jsx)(n.code,{children:"VSCode"})," 插件。\n",(0,t.jsx)(n.a,{href:"https://code.visualstudio.com/api/working-with-extensions/publishing-extension",rel:"noopener noreferrer",target:"_blank",children:"VSCode 详尽的发布插件官方文档"})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"如果看完有收获，欢迎点赞、评论、分享支持。你的支持和肯定，是我写作的动力"}),"。"]}),"\n",(0,t.jsxs)(n.h2,{id:"8-加源码共读交流群",children:[(0,t.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#8-加源码共读交流群",children:"#"}),"8. 加源码共读交流群"]}),"\n",(0,t.jsxs)(n.p,{children:["最后可以持续关注我",(0,t.jsx)(n.a,{href:"https://juejin.cn/user/1415826704971918",rel:"noopener noreferrer",target:"_blank",children:"@若川"}),"，欢迎 ",(0,t.jsx)(n.code,{children:"follow"})," ",(0,t.jsx)(n.a,{href:"https://github.com/ruochuan12",rel:"noopener noreferrer",target:"_blank",children:"我的 github"}),"。另外，想学源码，极力推荐关注我写的专栏",(0,t.jsx)(n.a,{href:"https://juejin.cn/column/6960551178908205093",rel:"noopener noreferrer",target:"_blank",children:"《学习源码整体架构系列》"}),"，目前是掘金关注人数（4.7k+人）第一的专栏，写有20余篇源码文章。"]}),"\n",(0,t.jsxs)(n.p,{children:["我倾力持续组织了一年多",(0,t.jsx)(n.a,{href:"https://juejin.cn/post/7079706017579139102",rel:"noopener noreferrer",target:"_blank",children:"每周大家一起学习200行左右的源码共读活动"}),"，感兴趣的可以",(0,t.jsxs)(n.a,{href:"https://juejin.cn/pin/7217386885793595453",rel:"noopener noreferrer",target:"_blank",children:["点此扫码加我微信 ",(0,t.jsx)(n.code,{children:"ruochuan02"})," 参与"]}),"。"]})]})}function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,i.ah)(),e.components);return n?(0,t.jsx)(n,Object.assign({},e,{children:(0,t.jsx)(p,e)})):p(e)}let g=u;u.__RSPRESS_PAGE_META={},u.__RSPRESS_PAGE_META["open-in-github%2Findex.md"]={toc:[{id:"1-前言",text:"1. 前言",depth:2},{id:"2-环境准备",text:"2. 环境准备",depth:2},{id:"3-vscode-open-in-github-button-项目",text:"3. vscode-open-in-github-button 项目",depth:2},{id:"31-packagejson-scripts-命令解析",text:"3.1 package.json scripts 命令解析",depth:3},{id:"32-github-actions",text:"3.2 github actions",depth:3},{id:"321-ci",text:"3.2.1 ci",depth:4},{id:"322-release-发布",text:"3.2.2 release 发布",depth:4},{id:"323-vitest-测试",text:"3.2.3 vitest 测试",depth:4},{id:"33-入口文件-indexts",text:"3.3 入口文件 index.ts",depth:3},{id:"34-openingithubopenproject",text:"3.4 openInGitHub.openProject",depth:3},{id:"4-vscode-open-in-github-packagejson",text:"4. vscode-open-in-github package.json",depth:2},{id:"5-调试项目",text:"5. 调试项目",depth:2},{id:"6-入口-srcextensionts",text:"6. 入口 src/extension.ts",depth:2},{id:"61-utils-工具函数",text:"6.1 Utils 工具函数",depth:3},{id:"62-commands-导出的命令函数",text:"6.2 Commands 导出的命令函数",depth:3},{id:"63-url-对象",text:"6.3 URL 对象",depth:3},{id:"631-urlget-函数",text:"6.3.1 URL.get 函数",depth:4},{id:"64-utilsrepo-对象",text:"6.4 Utils.repo 对象",depth:3},{id:"641-utilsrepogeturl-获取-url",text:"6.4.1 Utils.repo.getUrl 获取 Url",depth:4},{id:"7-总结",text:"7. 总结",depth:2},{id:"8-加源码共读交流群",text:"8. 加源码共读交流群",depth:2}],title:"神器啊，从未想过 VSCode 还能这样直接打开仓库URL，原理揭秘~",headingTitle:"神器啊，从未想过 VSCode 还能这样直接打开仓库URL，原理揭秘~",frontmatter:{}}},20713:function(e,n,r){r.d(n,{Z:()=>c});var t=r(52676),i=r(75271),s=r(92815);r(18544);let o={"zh-CN":e=>`\u{9884}\u{8BA1}\u{9605}\u{8BFB}\u{65F6}\u{95F4}: ${e.minutes>=1?`${Math.ceil(e.minutes)} \u{5206}\u{949F}`:"小于 1 分钟"}`,"en-US":e=>`Estimated reading time: ${e.minutes>=1?`${Math.ceil(e.minutes)} minutes`:"less than 1 minute"}`};function a(e,n,r){let t=Object.keys(o).includes(n)?n:r;return o[t](e)}let c=e=>{let{defaultLocale:n="en-US"}=e,r=(0,s.Vi)().page.readingTimeData,o=(0,s.Jr)(),c=(0,s.e7)(),[h,l]=(0,i.useState)(a(r,o,n));return(0,i.useEffect)(()=>{l(a(r,o,n))},[o,r]),(0,t.jsx)("span",{"data-dark":String(c),className:"rp-reading-time",children:h})}}}]);